<!DOCTYPE html>
<head>
    <meta charset="utf-8"/>
    <link rel="dns-prefetch preconnect" href="https://u.jimcdn.com/" crossorigin="anonymous"/>
    <link rel="dns-prefetch preconnect" href="https://assets.jimstatic.com/" crossorigin="anonymous"/>
    <link rel="dns-prefetch preconnect" href="https://image.jimcdn.com" crossorigin="anonymous"/>
    <link rel="dns-prefetch preconnect" href="https://fonts.jimstatic.com" crossorigin="anonymous"/>
    <link rel="dns-prefetch preconnect" href="https://www.google-analytics.com" crossorigin="anonymous"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="description" content=""/>
    <meta name="robots" content="index, follow, archive"/>
    <meta property="st:section" content=""/>
 
    <title>ESAS Deconstruction</title>
 


    <style>
    html, body {
        margin:0
    }

    .hidden {
        display:none
    }

    .n {
        padding:5px
    }

    #emotion-header {
        position:relative
    }

    #emotion-header-logo, #emotion-header-title {
        position: absolute
    }
    </style>

    <link href="https://u.jimcdn.com/cms/o/s1c71c378b473a4b7/layout/l18102fdb581481be/css/main.css?t=1678435519" rel="stylesheet" type="text/css" id="jimdo_main_css"/>
    <link href="https://u.jimcdn.com/cms/o/s1c71c378b473a4b7/layout/l18102fdb581481be/css/layout.css?t=1481798901" rel="stylesheet" type="text/css" id="jimdo_layout_css"/>
    <link href="https://u.jimcdn.com/cms/o/s1c71c378b473a4b7/layout/l18102fdb581481be/css/font.css?t=1678435519" rel="stylesheet" type="text/css" id="jimdo_font_css"/>
    <script>

      
    /* <![CDATA[ */
    /*!  loadCss [c]2014 @scottjehl, Filament Group, Inc.  Licensed MIT */
    window.loadCSS = window.loadCss = function(e, n, t) {
        var r,
            l = window.document,
            a = l.createElement("link");
        if (n)
            r = n;
        else {
            var i = (l.body || l.getElementsByTagName("head")[0]).childNodes;
            r = i[i.length - 1]
        }
        var o = l.styleSheets;
        a.rel = "stylesheet",
        a.href = e,
        a.media = "only x",
        r.parentNode.insertBefore(a, n ? r : r.nextSibling);
        var d = function(e) {
            for (var n = a.href, t = o.length; t--;)
                if (o[t].href === n)
                    return e.call(a);
            setTimeout(function() {
                d(e)
            })
        };
        return a.onloadcssdefined = d, d(function() {
            a.media = t || "all"
        }), a
    };
    window.onloadCSS = function(n, o) {
        n.onload = function() {
            n.onload = null,
            o && o.call(n)
        },
        "isApplicationInstalled" in navigator && "onloadcssdefined" in n && n.onloadcssdefined(o)
    } /* ]]> */
    </script>
    <script>
    // <![CDATA[
    onloadCSS(loadCss('https://assets.jimstatic.com/web_oldtemplate.css.484168258c63bd4f69a74e0370dc7ab9.css'), function() {
        this.id = 'jimdo_web_css';
    });
    // ]]>
    </script>
    <link href="https://assets.jimstatic.com/web_oldtemplate.css.484168258c63bd4f69a74e0370dc7ab9.css" rel="preload" as="style"/>
    <noscript>
        <link href="https://assets.jimstatic.com/web_oldtemplate.css.484168258c63bd4f69a74e0370dc7ab9.css" rel="stylesheet"/>
    </noscript>
    <script>
    //<![CDATA[
    var jimdoData = {
        "isTestserver": false,
        "isLcJimdoCom": false,
        "isJimdoHelpCenter": false,
        "isProtectedPage": false,
        "cstok": "",
        "cacheJsKey": "dc04b44e71947b5963ce6fc1404a2bb2ea23e742",
        "cacheCssKey": "dc04b44e71947b5963ce6fc1404a2bb2ea23e742",
        "cdnUrl": "https:\/\/assets.jimstatic.com\/",
        "minUrl": "https:\/\/assets.jimstatic.com\/app\/cdn\/min\/file\/",
        "authUrl": "https:\/\/a.jimdo.com\/",
        "webPath": "https:\/\/www.npokokoro.jp\/",
        "appUrl": "https:\/\/a.jimdo.com\/",
        "cmsLanguage": "ja_JP",
        "isFreePackage": false,
        "mobile": false,
        "isDevkitTemplateUsed": false,
        "isTemplateResponsive": false,
        "websiteId": "s1c71c378b473a4b7",
        "pageId": 912164772,
        "packageId": 2,
        "shop": {
            "deliveryTimeTexts": {
                "1": "\u304a\u5c4a\u3051\u65e5\u6570\uff1a1~3\u65e5",
                "2": "\u304a\u5c4a\u3051\u65e5\u6570\uff1a3~5\u65e5",
                "3": "\u304a\u5c4a\u3051\u65e5\u6570\uff1a5~8\u65e5"
            },
            "checkoutButtonText": "\u8cfc\u5165",
            "isReady": false,
            "currencyFormat": {
                "pattern": "\u00a4#,##0",
                "convertedPattern": "$#,##0",
                "symbols": {
                    "GROUPING_SEPARATOR": ",",
                    "DECIMAL_SEPARATOR": ".",
                    "CURRENCY_SYMBOL": "\uffe5"
                }
            },
            "currencyLocale": "ja_JP"
        },
        "tr": {
            "gmap": {
                "searchNotFound": "\u5165\u529b\u3055\u308c\u305f\u4f4f\u6240\u306f\u5b58\u5728\u3057\u306a\u3044\u304b\u3001\u898b\u3064\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002",
                "routeNotFound": "\u30eb\u30fc\u30c8\u304c\u8a08\u7b97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u76ee\u7684\u5730\u304c\u9060\u3059\u304e\u308b\u304b\u660e\u78ba\u3067\u306f\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002"
            },
            "shop": {
                "checkoutSubmit": {
                    "next": "\u6b21\u3078",
                    "wait": "\u304a\u5f85\u3061\u304f\u3060\u3055\u3044"
                },
                "paypalError": "\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002",
                "cartBar": "\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8\u3092\u78ba\u8a8d",
                "maintenance": "\u7533\u3057\u8a33\u3054\u3056\u3044\u307e\u305b\u3093\u3001\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u4e2d\u306e\u305f\u3081\u4e00\u6642\u7684\u306b\u30b7\u30e7\u30c3\u30d7\u304c\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002\u3054\u8ff7\u60d1\u3092\u304a\u304b\u3051\u3057\u7533\u3057\u8a33\u3054\u3056\u3044\u307e\u305b\u3093\u304c\u3001\u304a\u6642\u9593\u3092\u3042\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002",
                "addToCartOverlay": {
                    "productInsertedText": "\u30ab\u30fc\u30c8\u306b\u5546\u54c1\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f",
                    "continueShoppingText": "\u8cb7\u3044\u7269\u3092\u7d9a\u3051\u308b",
                    "reloadPageText": "\u66f4\u65b0"
                },
                "notReadyText": "\u3053\u3061\u3089\u306e\u30b7\u30e7\u30c3\u30d7\u306f\u73fe\u5728\u6e96\u5099\u4e2d\u306e\u305f\u3081\u3054\u5229\u7528\u3044\u305f\u3060\u3051\u307e\u305b\u3093\u3002\u30b7\u30e7\u30c3\u30d7\u30aa\u30fc\u30ca\u30fc\u306f\u4ee5\u4e0b\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002https:\/\/help.jimdo.com\/hc\/ja\/articles\/115005521583",
                "numLeftText": "\u73fe\u5728\u3053\u306e\u5546\u54c1\u306f {:num} \u307e\u3067\u8cfc\u5165\u3067\u304d\u307e\u3059\u3002",
                "oneLeftText": "\u3053\u306e\u5546\u54c1\u306e\u5728\u5eab\u306f\u6b8b\u308a1\u70b9\u3067\u3059"
            },
            "common": {
                "timeout": "\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3044\u305f\u3057\u307e\u3057\u305f\u3002\u5f8c\u307b\u3069\u518d\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002"
            },
            "form": {
                "badRequest": "\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u5f8c\u307b\u3069\u6539\u3081\u3066\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"
            }
        },
        "jQuery": "jimdoGen002",
        "isJimdoMobileApp": false,
        "bgConfig": null,
        "bgFullscreen": null,
        "responsiveBreakpointLandscape": 767,
        "responsiveBreakpointPortrait": 480,
        "copyableHeadlineLinks": false,
        "tocGeneration": false,
        "googlemapsConsoleKey": false,
        "loggingForAnalytics": false,
        "loggingForPredefinedPages": false,
        "isFacebookPixelIdEnabled": false,
        "userAccountId": "0c3325d1-6b0b-446f-bc3b-e47d8fbb0d02",
        "dmp": {
            "typesquareFontApiKey": "4L6CCYWjET8%3D",
            "typesquareFontApiScriptUrl": "\/\/code.typesquare.com\/static\/4L6CCYWjET8%253D\/ts105.js",
            "typesquareFontsAvailable": true
        }
    };
    // ]]>
    </script>

    <script type="text/javascript">
    window.CKIES_OPTIN = true;
    </script>
    <script type="text/javascript">
    if (document.cookie.indexOf('ga-disable-UA-24230777-25') != -1 || !window.CookieControl.isCookieAllowed('ga') || !window.CookieControl.isCookieAllowed('jimdo_analytics')) {
        window['ga-disable-UA-24230777-25'] = true;
    }
    </script>
    <script>
    (function(window) {
        'use strict';
        var regBuff = window.__regModuleBuffer = [];
        var regModuleBuffer = function() {
            var args = [].slice.call(arguments);
            regBuff.push(args);
        };
        if (!window.regModule) {
            window.regModule = regModuleBuffer;
        }
    })(window);
    </script>
    <script src="https://assets.jimstatic.com/web.js.12719f3724127512fa9f.js" async="true"></script>

</head>
<body class="body cc-page cc-page-index cc-indexpage cc-pagemode-default cc-content-parent" id="page-912164772">

    <div id="cc-inner" class="cc-content-parent">
        <div id="cc-tp-padding-container" class="cc-content-parent">
            <div id="cc-tp-container" class="cc-content-parent">

                <div id="cc-tp-header">

                </div>

                <div id="cc-tp-wrapper">

                    <div id="cc-tp-navigation">
                        <div id="cc-tp-nav-top"></div>
                        <div class="cc-tp-gutter">
                            <div data-container="navigation">
                                <div class="j-nav-variant-standard">
                                    <ul id="mainNav1" class="mainNav1">
                                        <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/esas_DC/" class="current level_1">
                                                <span>HOME</span>
                                            </a>
                                        </li>
                                        <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/esas_DC/filter_SP.html" class="current level_1"> <!-- target="_blank"-->
                                                <span>Filtering for Soft Protons</span>
                                            </a>
                                        </li>
                                        <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/esas_DC/filter_SP.html" class="current level_1">
                                                <span>Anomalous CCD Check</span>
                                            </a>
                                        </li>
                                        <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/esas_DC/cheese.html" class="current level_1">
                                                <span>Masking Point Sources (Cheese)</span>
                                            </a>
                                        </li>
                                        <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/esas_DC/fovimage.html" class="current level_1">
                                                <span>FOV Image</span>
                                            </a>
                                        </li>
                                        <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/esas_DC/fovspectrum.html" class="current level_1">
                                                <span>FOV Spectrum</span>
                                            </a>
                                        </li>
					   <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/about_me.html" class="current level_1">                                                <span>About Me</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div id="cc-tp-nav-btm"></div>
                    </div>
	
                    <div id="cc-tp-sidebar">
                        <div id="cc-tp-sidebar-top"></div>
                        <div class="cc-tp-gutter">
                            <div data-container="sidebar">
                                <div id="cc-matrix-1112072072">
                                    <div id="cc-m-11549662272" class="j-module n j-text ">
                                      <p style="text-align: center;">

                                      <p style="text-align: center;">
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="cc-tp-sidebar-btm"></div>
                    </div>

                </div>

                <div id="cc-tp-content" class="cc-content-parent">
                    <div id="cc-tp-content-top"></div>
                    <div class="cc-tp-gutter cc-content-parent">
                        <div id="content_area" data-container="content">
                            <div id="content_start"></div>

                            <div id="cc-matrix-1112072272">
                                <div id="cc-m-4981642472" class="j-module n j-header ">
                                    <h1 class="" id="cc-m-header-4981642472">Masking Point Sources(Cheese)</h1>
                                </div>
                                <div id="cc-m-4981638072" class="j-module n j-textWithImage ">
                                    <figure class="cc-imagewrapper cc-m-image-align-1">
                                       
                                     

                                    </figure>
                                    <div>
                                        <div id="cc-m-textwithimage-4981638072" data-name="text" data-action="text" class="cc-m-textwithimage-inline-rte">
                                            <!-- 
					    <p>
                                                <span style="color: #000000;">
                                                    <strong>Welcome to ESAS Deconstruction</strong>
                                                </span>
                                            </p>
                                             --> 


<!--
===============================================================================================================================
  -->
<p><br></p>
<p><span style="text-shadow: rgba(136, 136, 136, 0.8) 3px 3px 20px; font-size: 14px; font-family: Arial, Helvetica, sans-serif;">Source: MCXC J0106.8+0103<br></span><span style="font-family: Arial, Helvetica, sans-serif;"><span style="text-shadow: rgba(136, 136, 136, 0.8) 3px 3px 20px; font-size: 14px;">Observation ID: 0762870601<br>SAS Version: 19.0.0</span></span></p>
<br>
					      <span lang="EN-GB" style="font-family: inherit; line-height: 18.4px;"><br /></span></div><p style="text-align: left;">The finished products and the&nbsp;scripts can be downloaded <a href="https://github.com/poonh/esas_DC/raw/main/cheese.zip">here.</a></p>
			<br>
					<p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-GB" style="font-family: inherit;">All files produced in this tutorial are found in&nbsp;<i>esas_products/cheese</i>. Please note that some files have several updates. Those in the folder are files of the final update. For the scripts used in this chapter, they are in <i>src/</i>, and finally, you find the original  <i>ESAS</i> commands in  <i>command/</i>. </span></p>Please note that you need to finish 
					  <a href="https://poonh.github.io/esas_DC/filter_SP.html" class="current level_1" target=”_blank” >  Filter for Soft Protons</a>
					    before you start this one. <br>





					<p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><span lang="EN-GB">In ESAS,</span><span lang="EN-GB">&nbsp;</span><i><span lang="EN-US">cheese&nbsp;</span></i><span lang="EN-US">is used to mask point sources. Another common way to do is&nbsp;<i>ewavelet</i>.<o:p></o:p></span></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">Here is the standard way to use cheese:</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;">cheese prefixm="1S001 2S002 " prefixp=S003 scale=0.25 rate=0.0001 dist=0 clobber=1 elow=400 ehigh=2300&nbsp;&nbsp;&gt; log/cheese.log<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">and you find the final products you need –&nbsp;<i>mos2S002-bkg_region-det.fits</i>,</span><span lang="EN-US">&nbsp;</span><i><span lang="EN-GB">mos2</span></i><i><span lang="EN-US">S002-bkg_region-sky.fits</span></i><span lang="EN-US">&nbsp;and&nbsp;<i>mos2S002-cheese.fits</i>. However, for SAS 19.0.0,&nbsp;<i>cheese&nbsp;</i>automatically deletes and renames some files upon completion. If you want to understand better what happens. I suggest running:</span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;">source command/cheese.csh<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><i><span lang="EN-US">cheese_full.csh</span></i><span lang="EN-US">&nbsp;has got all the sub-commands. In this tutorial, I use the products produced from this.&nbsp;</span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">and then you run selected commands in:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;">python src/cheese_script.py</span></i></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Open the python script and see what you need.&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Here are the basic steps in&nbsp;<i>cheese</i>.</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">1.Produce the following for point source detection:<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">a) an image extracted from mos2S002-clean.fits in a certain energy range of your choice<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">b) an exposure map in the same energy range<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">c) create a “mask” image from the exposure map on which the point sources search will perform. This is an image indicating the valid region for the search. CCDs and bad pixels are invalid regions with a value = 0, and all other parts =1.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><span lang="EN-US">&nbsp;</span>2. run&nbsp;<i>eboxdetect</i>&nbsp;for the first time for local detection to produce a file called&nbsp;<i>eboxlist_l.fits.&nbsp;</i>This file contains detected point sources information.</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">3. Run&nbsp;<i>esplinemap</i>&nbsp;using&nbsp;<i>eboxlist_l.fits</i>&nbsp;to produce a background map called&nbsp;<i>mos2S002-obj-imbkg.fits</i>&nbsp;from non-source regions.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">4. Run&nbsp;<i>eboxdetect</i>&nbsp;for the second time for map detection using the background map produced from the previous step. A file called&nbsp;<i>eboxlist_m.fits</i>&nbsp;is produced, which has some overlap with&nbsp;</span><i><span lang="EN-US">eboxlist_l.fits.</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">5. Run<i>&nbsp;emldetect</i>&nbsp;to perform psf fitting on the point sources in&nbsp;<i>eboxlist_m.fits</i>. The final sources satisfying selection criteria is put in&nbsp;<i>emllist.fits</i>.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">6. Run&nbsp;<i>region</i>&nbsp;twice to create wo fits files which contain the size and coordinates of the detected point sources satisfying selection criteria in sky and detector coordinates. The files are called&nbsp;<i>mos2S002-bkg_region-sky.fits</i>&nbsp;and&nbsp;<i>mos2S002-bkg_region-det.fits</i>.&nbsp;<i>mos2S002-bkg_region-det.fits</i>&nbsp;is used to mask point sources when producing a spectrum.&nbsp;<i>mos2S002-bkg_region-sky.fits</i>&nbsp;is used to create a mask in the image form which is used when handling image data in the next step. The point sources detected<i>&nbsp;</i>are different for different ccds. If you want the same mask for all ccds, update&nbsp;<i>mos2S002-bkg_region-sky.fits</i>&nbsp;and&nbsp;<i>mos2S002-bkg_region-det.fits</i>&nbsp;in this step.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">7. Run&nbsp;<i>make_mask</i>&nbsp;to translate the coordinates and sizes of the point sources in&nbsp;<i>mos2S002-bkg_region-sky.fits</i>&nbsp;to an image. The final product is&nbsp;<i>mos2S002-cheese</i>.<i>fits.&nbsp;</i>This file is used when handling image data.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;">8. Remove or add a mask. The source you feel interested in is probably masked. You have to remove it. Or if you want to enlarge the size of a certain mask or even add an extra mask, do it in this step.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Here comes the details:<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">1.Production of an image, exposure map and mask in a certain energy range.</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">For the energy range, choose the one you work on. My example is [0.3 – 2.4] keV, the range I use for image data. Of course, we use a far wider range for spectroscopic data, but using the narrow range would result in no difference, I believe.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">Here are the steps for producing the image, exposure map and mask. All are in&nbsp;<i>src/cheese_full.csh.</i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">Image<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: inherit;">evselect table=mos2S002-clean.fits:EVENTS withfilteredset=yes expression='(PATTERN&lt;=12)&amp;&amp;(FLAG == 0)&amp;&amp;(PI in [400:2300])' filtertype=expression imagebinning='imageSize' imagedatatype='Int32' imageset=mos2S002-obj-im.fits squarepixels=yes ignorelegallimits=yes withxranges=yes withyranges=yes xcolumn='X' ximagesize=900 ximagemax=48400 ximagemin=3401 ycolumn='Y' yimagesize=900 yimagemax=48400 yimagemin=3401 updateexposure=yes filterexposure=yes verbosity=1<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhFmLqE61V3bYm3xQjY5oBNjXSeesQrbV8fGne1of3sToDrCXz7HDe8TmFqFyw1--14illVO9LiP_2jdCUv_TrYbk61yk-eNneK6_RXSzUvjkHlhMwMBK20SeHf63grjTeESwpCTSYZTZ7J9uJiRx7JJUDx8u0DPysDe9arqTJuuaG5h1js2puLpZxn/s904/cheese_img.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" data-original-height="904" data-original-width="898" height="400" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhFmLqE61V3bYm3xQjY5oBNjXSeesQrbV8fGne1of3sToDrCXz7HDe8TmFqFyw1--14illVO9LiP_2jdCUv_TrYbk61yk-eNneK6_RXSzUvjkHlhMwMBK20SeHf63grjTeESwpCTSYZTZ7J9uJiRx7JJUDx8u0DPysDe9arqTJuuaG5h1js2puLpZxn/w398-h400/cheese_img.png" width="398" /></a><i><span lang="EN-US" style="color: red;">&nbsp;</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">an image extracted from&nbsp;<i>mos2S002-clean.fits</i>&nbsp;in [0.4 – 2.3] keV. This image shows the photons in this energy range.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><span lang="EN-US">&nbsp;</span>exposure map</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: inherit;">eexpmap imageset=mos2S002-obj-im.fits attitudeset=atthk.fits eventset=mos2S002-clean.fits expimageset=mos2S002-obj-imexp.fits withdetcoords=no withvignetting=yes usefastpixelization=no usedlimap=no attrebin=4 pimin=400 pimax=2300&nbsp;<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><span lang="EN-US">&nbsp;</span><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj4xsWF0ZS11WwKa3L_TBYM2Wu2bB8MgnPZMmEcyTKwyjz-VFnv-nHY-RqUN6gT1OCFS0k9u8hKxVN-C1P24MR_r14psE4wdvpKZY0yvdX32HX_DcqGpi2D3cODCpaVDdUPkdTolZTuAGSbi-lejyxjmZTVU1LRLFdVMzPQiOHE5_Y9q5lC_KJkKk8p/s896/cheese_exp.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" data-original-height="896" data-original-width="890" height="400" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj4xsWF0ZS11WwKa3L_TBYM2Wu2bB8MgnPZMmEcyTKwyjz-VFnv-nHY-RqUN6gT1OCFS0k9u8hKxVN-C1P24MR_r14psE4wdvpKZY0yvdX32HX_DcqGpi2D3cODCpaVDdUPkdTolZTuAGSbi-lejyxjmZTVU1LRLFdVMzPQiOHE5_Y9q5lC_KJkKk8p/w398-h400/cheese_exp.png" width="398" /></a></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><span lang="EN-US">an exposure map in&nbsp;[0.4 – 2.3] keV. This has been corrected for vignetting effect. Otherwise, all pixels have the same value.&nbsp;</span>&nbsp;</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">mask<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: inherit;">emask expimageset=mos2S002-obj-imexp.fits detmaskset=mos2S002-obj-immask.fits detmasktable=MASK threshold1=0.3 threshold2=0.5<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEirLLA7f6OuY-jGFt6qvo78VyU6Keb5A6PmnqUmFeMBU0qL4I9lZPDxips0lPbTsP3lS72Gn6plD-WDuuh_rP8By9SCueVQoNenCutkopHH7O3-y1Mz9AviQ9UAf28_X0bFX_lJqod57flMmbm_a1QKfaTsra7SNQFlfYxzGYejZMzDSDC65H5lVwUi/s904/cheese_inmask.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-family: inherit;"><img border="0" data-original-height="904" data-original-width="892" height="400" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEirLLA7f6OuY-jGFt6qvo78VyU6Keb5A6PmnqUmFeMBU0qL4I9lZPDxips0lPbTsP3lS72Gn6plD-WDuuh_rP8By9SCueVQoNenCutkopHH7O3-y1Mz9AviQ9UAf28_X0bFX_lJqod57flMmbm_a1QKfaTsra7SNQFlfYxzGYejZMzDSDC65H5lVwUi/w395-h400/cheese_inmask.png" width="395" /></span></a></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">A mask indicating ccd gaps and bad pixels. All pixels have either a value of 0 or 1. Point source searches only perform on pixels with a value = 1.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><span lang="EN-US">&nbsp;</span>2. run&nbsp;<i>eboxdetect</i>&nbsp;for the first time for local detection to produce a file called&nbsp;<i>eboxlist_l.fits.&nbsp;</i>This file contains detected point sources information.</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><i><span lang="EN-US" style="color: red;">eboxdetect detmasksets='pnS003-obj-immask.fits mos1S001-obj-immask.fits mos2S002-obj-immask.fits' withdetmask=yes expimagesets='pnS003-obj-imexp.fits mos1S001-obj-imexp.fits mos2S002-obj-imexp.fits' withexpimage=yes nruns=3&nbsp;</span></i><b><span lang="EN-US">likemin=15</span></b><i><span lang="EN-US" style="color: red;">&nbsp;boxsize=5 ecf='3.2 1.2 1.2' imagesets='pnS003-obj-im.fits mos1S001-obj-im.fits mos2S002-obj-im.fits' boxlistset=eboxlist_l.fits hrdef='1 2 2 3 3 4' pimin='400 400 400' pimax='2300 2300 2300' obsmode=pointing</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">The critical parameter here is&nbsp;<i>likemin,&nbsp;</i>which determines the minimum detection likelihood. Now you can take a look at this file:</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: inherit;">fv eboxlist_l.fits &amp;<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;">It has 33 columns and 268 rows. For the column ID_INST,0=summary,1=pn,2=mos1,3=mos2. Check other parameters yourself.&nbsp;</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">3. Run&nbsp;<i>esplinemap</i>&nbsp;using&nbsp;<i>eboxlist_l.fits</i>&nbsp;to produce a background map called&nbsp;<i>mos2S002-obj-imbkg.fits</i>&nbsp;from non-source regions<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><i><span lang="EN-US" style="color: red;">esplinemap&nbsp;</span></i><b><span lang="EN-US">scut=0.01 mlmin=1</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">nsplinenodes=20 excesssigma=4 nfitrun=3 idband=1 boxlistset=eboxlist_l.fits imageset=mos2S002-obj-im.fits expimageset=mos2S002-obj-imexp.fits withexpimage=yes detmaskset=mos2S002-obj-immask.fits withdetmask=yes bkgimageset=mos2S002-obj-imbkg.fits pimin=400 pimax=2300 fitmethod=spline snrmin=30 smoothsigma=15</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">The important parameters here are&nbsp;<i>scut</i>&nbsp;and&nbsp;<i>mlmin</i>.&nbsp;<i>scut&nbsp;</i>is the source cut level in counts/arcsec**2.&nbsp;<i>mlmin</i>&nbsp;is the minimum detection likelihood. The product of this command is&nbsp;<i>mos2S002-obj-imbkg.fits.&nbsp;</i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiiqSVcC0gGwmJ4eNKV2rZvN27pH43dRe8T09ttbMLYR5cuFkgWDJG_4uA_QO8-looxytOtkWmvvb-4DJ_XPr3nrAMZpvLHg67HzaZ-VpRHpKyO7XnKRY8ltUslpCn1ZmZYlRh7qbUF0x5DjV-iASfxWFgXybCozXkRulOProK8oksn6D-pKZQX71-j/s892/cheese_spline.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-family: inherit;"><img border="0" data-original-height="892" data-original-width="888" height="400" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiiqSVcC0gGwmJ4eNKV2rZvN27pH43dRe8T09ttbMLYR5cuFkgWDJG_4uA_QO8-looxytOtkWmvvb-4DJ_XPr3nrAMZpvLHg67HzaZ-VpRHpKyO7XnKRY8ltUslpCn1ZmZYlRh7qbUF0x5DjV-iASfxWFgXybCozXkRulOProK8oksn6D-pKZQX71-j/w399-h400/cheese_spline.png" width="399" /></span></a></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><i><span lang="EN-US">mos2S002-obj-imbkg.fits,&nbsp;</span></i><span lang="EN-US">A background map produced from&nbsp;<i>esplinemap</i>.<o:p></o:p></span></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;">&nbsp;<span lang="EN-US">4. Run&nbsp;<i>eboxdetect&nbsp;</i>for the second time for map detection using the background map produced from the previous step(</span><i><span lang="EN-US">mos2S002-obj-imbkg.fits</span></i><span lang="EN-US">). A file called&nbsp;<i>eboxlist_m.fits</i>&nbsp;is produced, which has more sources (336) than&nbsp;</span><i><span lang="EN-US">eboxlist_l.fits</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><i><span lang="EN-US" style="color: red;">eboxdetect bkgimagesets='pnS003-obj-imbkg.fits mos1S001-obj-imbkg.fits mos2S002-obj-imbkg.fits' usemap=yes usematchedfilter=no detmasksets='pnS003-obj-immask.fits mos1S001-obj-immask.fits mos2S002-obj-immask.fits' withdetmask=yes expimagesets='pnS003-obj-imexp.fits mos1S001-obj-imexp.fits mos2S002-obj-imexp.fits' withexpimage=yes nruns=3&nbsp;</span></i><b><span lang="EN-US">likemin=15</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">boxsize=5 withimagebuffersize=no imagebuffersize=640 ecf='3.2 1.2 1.2' imagesets='pnS003-obj-im.fits mos1S001-obj-im.fits mos2S002-obj-im.fits' boxlistset=eboxlist_m.fits withoffsets=no mergedlistset=mergedlist.fits hrdef='1 2 2 3 3 4' pimin='400 400 400' pimax='2300 2300 2300' obsmode=pointing</span></i><i><span lang="EN-US" style="color: red;">&nbsp;</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Again the important parameter is&nbsp;<i>likemin.&nbsp;</i>Lowering this would result in more sources detected.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">5. Run<i>&nbsp;emldetect</i>&nbsp;to perform psf fitting on the sources in&nbsp;<i>eboxlist_m.fits</i>. The final sources satisfying selection criteria is put in&nbsp;<i>emllist.fits</i>.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><i><span lang="EN-US" style="color: red;">emldetect boxlistset=eboxlist_m.fits mllistset=</span></i><b><span lang="EN-US">emllist.fits</span></b><i><span lang="EN-US">&nbsp;</span></i><b><span lang="EN-US">mlmin=10</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">determineerrors=yes fitposition=yes psfmodel=ellbeta nmaxfit=1 nmulsou=1&nbsp;</span></i><b><span lang="EN-US">ecut=15 scut=15</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">fitextent=yes extentmodel=beta dmlextmin=6 minextent=1.5 maxextent=20 withthreshold=yes threshold=15 threshcolumn=LIKE withtwostage=yes withimagebuffersize=no imagebuffersize=640 withxidband=no xidfixed=no rateonly=no simulate=no pimin='400 400 400' pimax='2300 2300 2300' hrpndef='1 2 2 3 3 4 4 5' xidpndef='2 3 4' hrm1def='1 2 2 3 3 4 4 5' xidm1def='2 3 4' hrm2def='1 2 2 3 3 4 4 5' xidm2def='2 3 4' ecf='3.2 1.2 1.2' xidecf=1 fitcounts=yes fitnegative=no mergedlistset=mergedlist.fits useevents=no usecalpsf=yes withhotpixelfilter=no withoffsets=no withrawrows=no tmpwrite=0 imagesets='pnS003-obj-im.fits mos1S001-obj-im.fits mos2S002-obj-im.fits' bkgimagesets='pnS003-obj-imbkg.fits mos1S001-obj-imbkg.fits mos2S002-obj-imbkg.fits' detmasksets='pnS003-obj-immask.fits mos1S001-obj-immask.fits mos2S002-obj-immask.fits' withdetmask=yes expimagesets='pnS003-obj-imexp.fits mos1S001-obj-imexp.fits mos2S002-obj-imexp.fits' withexpimage=yes&nbsp;</span></i><b><span lang="EN-US">sourceimagesets='pnS003-obj-imsmap.fits mos1S001-obj-imsmap.fits mos2S002-obj-imsmap.fits'</span></b><i><span lang="EN-US" style="color: red;">&nbsp;withsourcemap=yes</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">The most important parameter is again&nbsp;<i>mlmin</i>&nbsp;(minimum detection likelihood).&nbsp;<i>scut&nbsp;</i>(source selection radius for fitting) and&nbsp;<i>ecut</i>&nbsp;(source cut-out radius) may also have some effect in the result of source detection.&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Now all detected sources are in&nbsp;<i>emllist.fits</i>. Let’s open it:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;">fv emllist.fits &amp;</span></i></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">It has got 46 columns, including those in&nbsp;<i>eboxlist_m.fits</i>&nbsp;An important new column here is&nbsp;<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><i><span lang="EN-US">DET_ML</span></i><span lang="EN-US">, which is the detection likelihood. It will be used in the final extraction of the mask. When you add up this value of different ccds under the same&nbsp;<i>ID_CLUSTER</i>, it is roughly the summary column (i.e.&nbsp;<i>ID_INST</i>&nbsp;= 0).&nbsp;</span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">To make it easier to read, let’s output the important columns which will be used in the final mask extraction into a file called&nbsp;<i>emllist.txt</i>:<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">&nbsp;</span><i><span lang="EN-US" style="color: red;">fdump emllist.fits+1 emllist.txt "ID_INST ID_BAND ID_CLUSTER FLUX DET_ML DIST_NN" - pagewidth=256 prhead=no clobber=yes</span></i>&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><span lang="EN-US">(<i>src/cheese_script.py:</i></span><span lang="EN-US">&nbsp;</span><i><span lang="EN-US">a.fitstotxt()&nbsp;</span></i><span lang="EN-US">for the above command<i>)<o:p></o:p></i></span></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><i><br /></i></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Now let’s open the source images which display all the sources detected in&nbsp;<i>emllist.fits</i>. These images are products of&nbsp;<i>emldetect.</i>They are the same for all ccds.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p><span style="font-family: inherit;"><i><span face="Arial, sans-serif" style="color: red;">ds9 pnS003-obj-imsmap.fits mos1S001-obj-imsmap.fits mos2S002-obj-imsmap.fits - frame lock image -zoom to fit -zscale -frame prev -zscale -frame prev -zscale &amp;&nbsp;</span></i><o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjDAqjB5jxvTbU7Qrv146JHZDYt_mKq3nI1xoYOtfojlVb1fIe236QsRToju55nVSb9fUjGBbnFZCZRMY5VEIyGusVFftZvH-jgRzvxbuweZJMr5kooav6F_qQIyNXf1xtOGHvTBgd1R06hXpMtstSUXPmLDcQoSVNiIwNWpcV6HvPNJ11LIW8JcSaJ/s1142/cheese_srcimage.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-family: inherit;"><img border="0" data-original-height="1142" data-original-width="1134" height="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjDAqjB5jxvTbU7Qrv146JHZDYt_mKq3nI1xoYOtfojlVb1fIe236QsRToju55nVSb9fUjGBbnFZCZRMY5VEIyGusVFftZvH-jgRzvxbuweZJMr5kooav6F_qQIyNXf1xtOGHvTBgd1R06hXpMtstSUXPmLDcQoSVNiIwNWpcV6HvPNJ11LIW8JcSaJ/w637-h640/cheese_srcimage.png" width="637" /></span></a></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><i><span lang="EN-GB">pnS003-obj-imsmap.fits,mos1S001-obj-imsmap.fits&nbsp;</span></i><span lang="EN-GB">and<i>&nbsp;mos2S002-obj-imsmap.fits.&nbsp;</i></span><span lang="EN-US">The images display the sources detected in&nbsp;<i>emllist.fits.</i></span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><i><br /></i></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Now you can test by running&nbsp;<i>emldetect</i>&nbsp;again, but change&nbsp;<i>mlmin</i>&nbsp;to a larger value, e.g. 150, and open&nbsp;<i>mos2S002-obj-imsmap.</i>fits. You find there are a lot less sources.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">6&amp;7. Now we have finalized the sources in&nbsp;<i>emllist.fits</i>. We have to make further cuts to have the final list. Run&nbsp;<i>region</i>twice to create two fits files which contain the size and coordinates of the detected point sources satisfying selection criteria in sky and detector coordinates. The files are called&nbsp;<i>mos2S002-bkg_region-sky.fits&nbsp;</i>(for image data, this file needs further processing) and&nbsp;<i>mos2S002-bkg_region-det.fits&nbsp;</i>(for spectroscopic data).&nbsp;<i><o:p></o:p></i></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Remember at the beginning you input some parameters when calling&nbsp;<i>cheese</i>? Here are when these parameters come into play!</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><i><span lang="EN-US" style="color: red;">region eventset=mos2S002-clean.fits operationstyle=global srclisttab=emllist.fits:SRCLIST expression='(</span></i><b><span lang="EN-US">FLUX &gt;= 1e-18</span></b><i><span lang="EN-US" style="color: red;">)&amp;&amp;(</span></i><b><span lang="EN-US">DET_ML &gt;= 15</span></b><i><span lang="EN-US" style="color: red;">)&amp;&amp;(</span></i><b><span lang="EN-US">ID_INST == 3</span></b><i><span lang="EN-US" style="color: red;">)&amp;&amp;(</span></i><b><span lang="EN-US">DIST_NN &gt;= 0</span></b><i><span lang="EN-US" style="color: red;">)&amp;&amp;(ID_BAND == 1)' bkgregionset=mos2S002-bkg_region-det.fits&nbsp;&nbsp;</span></i><b><span lang="EN-US">bkgfraction=0.25</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">radiusstyle=contour nosrcellipse=no&nbsp;</span></i><b><span lang="EN-US">outunit=detxy</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">verbosity=1</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><i><span lang="EN-US" style="color: red;">region eventset=mos2S002-clean.fits operationstyle=global srclisttab=emllist.fits:SRCLIST expression='(DIST_NN &gt;= 0)&amp;&amp;(DET_ML &gt;= 15)&amp;&amp;(ID_INST == 3)&amp;&amp;(FLUX &gt;= 1e-18)&amp;&amp;(ID_BAND == 1)' bkgregionset=mos2S002-bkg_region-sky.fits radiusstyle=contour nosrcellipse=no bkgfraction=0.25&nbsp;</span></i><b><span lang="EN-US">outunit=xy</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">verbosity=1</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><span lang="EN-US">When you run&nbsp;<i>cheese</i>, you input:&nbsp;<i>scale=0.25 rate=0.0001 dist=0</i>.&nbsp;<i>scale&nbsp;</i>is the&nbsp;<i>bkgfraction</i>, which means&nbsp;</span><span lang="EN-GB">the source is removed down to a level where the surface brightness of the source is one quarter of the surrounding background.&nbsp;</span><i><span lang="EN-US">rate=0.0001</span></i><span lang="EN-US">&nbsp;corresponds to&nbsp;<i>FLUX &gt;= 1e-18</i>.&nbsp;<i>rate=1</i>&nbsp;is 10**14 ergs /cm**2/s. and&nbsp;<i>dist=0</i>&nbsp;is&nbsp;<i>DIST_NN &gt;= 0</i>, which&nbsp;</span><span lang="EN-GB">is the minimum separation for sources in arc seconds (The cookbook suggests a default of 50, and can be as large as 1000).&nbsp;<i>outunit</i>&nbsp;is the source coordinate.&nbsp;<i>detxy&nbsp;</i>for detector and&nbsp;<i>xy</i>&nbsp;for sky coordinates.</span></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-GB" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">For&nbsp;<i>DET_ML &gt;= 15</i>, it is the detection likelihood limit.&nbsp;<i>ID_INST</i>&nbsp;indicates the instrument, with pn= 1, mos1=2, mos2=3. In this case, different ccds have their own mask since for the same source, they have a different&nbsp;<i>DET_ML</i>. Now let’s check how well the source mask masks sources. To begin with, let’s produce the rate image by dividing the counts image,&nbsp;<i>mos2S002-obj-im.fits</i>, by the exposure,&nbsp;<i>mos2S002-obj-imexp.fits</i>:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;">farith mos2S002-obj-im.fits mos2S002-obj-imexp.fits mos2S002-rate.fits DIV</span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">(<i>bin/cheese_script.py : a.makeImg()&nbsp;</i>for the above)</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Note that we don’t correct for oot events for pn here.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Next we have to convert&nbsp;<i>mos2S002-bkg_region-sky.fits&nbsp;</i>into ds9 readable format. The output is&nbsp;<i>mos2_sky.reg.&nbsp;</i>In<i>src/cheese_script.py</i>, you do it with this line:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="font-family: inherit;">a.regionextract("mos2S002-bkg_region-sky.fits",”mos2_sky.reg”)</span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">and the output is a text file with the coordinates and radii called&nbsp;<i>mos2_sky.reg</i>. If you convert other ccds and also the files for detector coordinates (<i>mos2S002-bkg_region-det.fits)</i>, you find for sky coordinates, different ccds have the same coordinates but not the detector ones. The radii are different for different ccds due to psf fitting.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">Let’s take a look to learn better.&nbsp;</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><div style="text-align: left;"><span style="font-family: inherit;"><i><span lang="EN-US" style="color: red;">emacs mos1_sky.reg mos2_sky.reg pn_sky.reg<br /></span></i><i><span lang="EN-US" style="color: red;">emacs mos1_det.reg mos2_det.reg pn_det.reg &amp;</span></i></span></div><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: inherit;">Then we open&nbsp;<i>mos2S002-rate.fits</i>&nbsp;with the point sources of&nbsp;<i>mos2S002-bkg_region-sky.fits&nbsp;</i>loaded. You can also compare with&nbsp;<i>mos2S002-obj-imsmap.fits</i>, which shows the point sources not passing the selection criteria.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">&nbsp;</span><i><span lang="EN-US" style="color: red;">ds9 mos2S002-rate.fits -scale limits 0 5e-5 -zoom to fit -smooth&nbsp;&nbsp;-region load mos2_sky.reg mos2S002-obj-imsmap.fits -zoom to fit -zscale &amp;</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg4TIsLchcOlCtq_MDqEashUF7sfhoEEmY7d5yfM2vwM-8NHMYAS0TBKr8rTfI-QlijZ1zN0wmzRluecGssHSKBWf6GnVYQ_6hDHbfeHLfKsF0BtRFdPtuboipdsBGVKhhYW1IaqOOKmRKZFziCOdsKldhn9tU8MeYlnB3EerwqjcJ8WFB1VL9oiVOZ/s1634/cheese_rate_imsmap.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-family: inherit;"><img border="0" data-original-height="820" data-original-width="1634" height="322" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg4TIsLchcOlCtq_MDqEashUF7sfhoEEmY7d5yfM2vwM-8NHMYAS0TBKr8rTfI-QlijZ1zN0wmzRluecGssHSKBWf6GnVYQ_6hDHbfeHLfKsF0BtRFdPtuboipdsBGVKhhYW1IaqOOKmRKZFziCOdsKldhn9tU8MeYlnB3EerwqjcJ8WFB1VL9oiVOZ/w640-h322/cheese_rate_imsmap.png" width="640" /></span></a></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">left:</span><i><span lang="EN-US" style="color: red;">&nbsp;</span></i><i><span lang="EN-US">mos2S002-rate.fits. right: mos2S002-obj-imsmap.fits,&nbsp;</span></i><span lang="EN-US">an image showing all sources in&nbsp;<i>emllist.fits.</i></span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><i><br /></i></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">&nbsp;</span>If you think it is not good, then do&nbsp;<i>region</i>&nbsp;again, lowering the threshold of&nbsp;<i>DET_ML</i>.&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">&nbsp;</span>Let’s check further all the ccds.</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">&nbsp;</span><i><span lang="EN-US" style="color: red;">ds9 mos1S001-rate.fits -scale limits 0 5e-5 -smooth -region load mos1_sky.reg mos2S002-rate.fits -scale limits 0 5e-5 -smooth -region load mos2_sky.reg pnS003-rate.fits -scale limits 0 5e-5 -zoom to fit -smooth -region load pn_sky.reg -frame prev -zoom to fit -frame prev -zoom to fit &amp;</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgvCHLT4L_cXCBDlzPQMzofXIwoL5zRU3WldSMxU_WQi-V4VNpdApd7pEERHeqzDa-Ctc3vtkxiCDY4nSPU1Lr9Di0PIVx-2ZfydI4O-qbOuTL3Ln6Kr-qOpAjd8hjYei6ilW4GsD42Uyl74FEATkyGMj2MjCEDSz5-QQ6viJIN6dp6UZft6v6IiaBo/s1370/cheese_all_v1.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-family: inherit;"><img border="0" data-original-height="1370" data-original-width="1324" height="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgvCHLT4L_cXCBDlzPQMzofXIwoL5zRU3WldSMxU_WQi-V4VNpdApd7pEERHeqzDa-Ctc3vtkxiCDY4nSPU1Lr9Di0PIVx-2ZfydI4O-qbOuTL3Ln6Kr-qOpAjd8hjYei6ilW4GsD42Uyl74FEATkyGMj2MjCEDSz5-QQ6viJIN6dp6UZft6v6IiaBo/w618-h640/cheese_all_v1.png" width="618" /></span></a></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">top left:&nbsp;</span><i><span lang="EN-US">mos1S001-rate.fits,</span></i><span lang="EN-US">top right<i>: mos1S001-rate.fits</i>, bottom left<i>: pnS003-rate.fits</i></span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><i><br /></i></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Pn finds a lot more point sources! I believe the reason is pn detects photons a few times higher than mos1 and mos2, resulting in a higher detection likelihood. Now let’s load the rate images of mos2 but with the pn region file loaded, and compare with the one you just loaded:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;">ds9 mos2S002-rate.fits -scale limits 0 5e-5 -smooth -region load mos2_sky.reg mos2S002-rate.fits -scale limits 0 5e-5 -smooth -region load pn_sky.reg -zoom to fit -frame prev -zoom to fit&nbsp;&nbsp;&amp;<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">&nbsp;</span><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiEUFqSagXTekdwwBW13p4ajVk5OhhRCSjfYvkV5zrPm8q3SUpn2Iv-jPCsv0_MVdXr4RaTExbMAceFr63KuGgMFiA94D3EIs_0pwf3HB177DSuLnN-cA_Crxu9aY7OWyyMHydqyhMfqZ51PUVKwEEpFdNTOJf_AzNCROzXDF8MjDoX-_2kAOxSX1fU/s2140/cheese_large.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" data-original-height="1190" data-original-width="2140" height="356" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiEUFqSagXTekdwwBW13p4ajVk5OhhRCSjfYvkV5zrPm8q3SUpn2Iv-jPCsv0_MVdXr4RaTExbMAceFr63KuGgMFiA94D3EIs_0pwf3HB177DSuLnN-cA_Crxu9aY7OWyyMHydqyhMfqZ51PUVKwEEpFdNTOJf_AzNCROzXDF8MjDoX-_2kAOxSX1fU/w640-h356/cheese_large.png" width="640" /></a></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;">Close-up of mosS002-rate.fits. The left one is loaded with mos2’s mask. The right one is loaded with pn’s mask. Green ellipses are common masks to both, cyan only found in mos2 and red only found in pn.&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">In this fig:cheese_large. You see in some red ellipses, there is a faint source, but just too dim to pass the selection criteria. The opposite also happens. There are sources found in mos2 but not pn. If you want all ccds having the same mask, we have to do&nbsp;<i>region</i>&nbsp;again but choose the summary band, i.e.</span><i><span lang="EN-US" style="color: red;">&nbsp;</span></i><i><span lang="EN-US">(ID_INST ==0 )&amp;&amp;( ID_BAND == 0)</span></i><span lang="EN-US">. But if you open&nbsp;<i>emllist.fits</i>, you find for&nbsp;<i>ID_BAND=0</i>, there are a lot of&nbsp;<i>FLUX</i>&nbsp;with “INDEF”.&nbsp;</span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Let’s take a look:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;">fdump emllist.fits+1 oldflux.txt "ID_INST FLUX" - pagewidth=256 prhead=no clobber=yes</span></i></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;">(This step is not found in&nbsp;<i>src/cheese_script.py</i>)</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;">If that mask is detected in one ccd (e.g. mos2 or pn), but falls on ccd gaps or missing ccds in another(e.g. mos1), the summary band would be “INDEF”. So, in order to use this band, we have to update&nbsp;<i>emllist.fits</i>&nbsp;first so that there is no INDEF value for the summary band. In&nbsp;<i>src/cheese_script.py</i>, you find the following line:</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><b><i><span lang="EN-US" style="font-family: inherit;">a.emllistUpdate()</span></i></b></p><p class="MsoNormal" style="line-height: normal;"><b><i><span lang="EN-US" style="font-family: inherit;"><br /></span></i></b></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;">The&nbsp;<i>FLUX&nbsp;</i>of the summary band is roughly the average of the ccds.&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Now check&nbsp;<i>emllist.fits</i>&nbsp;again:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;">fdump emllist.fits+1 newflux.txt "ID_INST FLUX" - pagewidth=256 prhead=no clobber=yes<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">(This step is not found in&nbsp;<i>src/cheese_script.py</i>)<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Compare&nbsp;<i>newflux.txt</i>&nbsp;and&nbsp;<i>oldflux.txt</i>, and you see&nbsp;<i>FLUX</i>&nbsp;is successfully updated.&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Now we do&nbsp;<i>region</i>&nbsp;again, this time using the summary band,(<i>ID_INST == 0)&amp;&amp;(ID_BAND == 0):</i><o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><i><br /></i></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">&nbsp;</span><i><span lang="EN-US" style="color: red;">region eventset=mos2S002-clean.fits operationstyle=global srclisttab=emllist.fits:SRCLIST expression='(FLUX &gt;= 1e-18)&amp;&amp;(DET_ML &gt;= 15)&amp;&amp;(ID_INST == 0)&amp;&amp;(DIST_NN &gt;= 0)&amp;&amp;(ID_BAND == 0)' bkgregionset=mos2S002-bkg_region-det.fits&nbsp;&nbsp;bkgfraction=0.25 radiusstyle=contour nosrcellipse=no outunit=detxy verbosity=1</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;">region eventset=mos2S002-clean.fits operationstyle=global srclisttab=emllist.fits:SRCLIST expression='(DIST_NN &gt;= 0)&amp;&amp;(DET_ML &gt;= 15)&amp;&amp;(ID_INST == 0)&amp;&amp;(FLUX &gt;= 1e-18)&amp;&amp;(ID_BAND == 0)' bkgregionset=mos2S002-bkg_region-sky.fits radiusstyle=contour nosrcellipse=no bkgfraction=0.25 outunit=xy verbosity=1</span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">then make the cheese image again:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><i><span lang="EN-US" style="color: red;">make_mask inimage=mos2S002-obj-im.fits inmask=mos2S002-mask-im.fits outmask=mos2S002-cheese.fits reglist=mos2S002-bkg_region-sky.fits &nbsp;</span></i><i><span lang="EN-US" style="color: red;">&nbsp;</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><i><span lang="EN-US">(src/cheese_script.py:</span></i><i><span lang="EN-US">a.remakeRegion())</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Now you open&nbsp;<i>mos1S001-cheese.fits, mos2S002-cheese.fits and pnS003-cheese.fits</i>, they all have the same masks. Sources detected in one ccd are also masked in other ccds.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p><span style="font-family: inherit;"><i><span face="Arial, sans-serif" style="color: red;">ds9 pnS003-</span></i><i><span face="Arial, sans-serif" lang="EN-US" style="color: red;">cheese</span></i><i><span face="Arial, sans-serif" style="color: red;">.fits mos1S001-</span></i><i><span face="Arial, sans-serif" lang="EN-US" style="color: red;">che ese</span></i><i><span face="Arial, sans-serif" style="color: red;">.fits mos2S002-</span></i><i><span face="Arial, sans-serif" lang="EN-US" style="color: red;">cheese</span></i><i><span face="Arial, sans-serif" style="color: red;">.fits -frame lock image -zoom to fit &amp;&nbsp;</span></i><o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgLZ-NnOSZgQdoLUF9GnuwNB_OOFMDLclhKL3_97YR9GRuFrmghWe6m1VcBc2yEu-cxcprGYh4kw8GQtECC7cAzI8TGgwfFmHLi4CSs_0RBizTUOvwR9tQUQPDc1I30Y1aexQDq3CEDUwecFRJ50o6Fcvwzz_bMfQMzpk3v7gwqqk9j0r7wGAOLbHs6/s1276/cheese_mask1.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-family: inherit;"><img border="0" data-original-height="1256" data-original-width="1276" height="630" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgLZ-NnOSZgQdoLUF9GnuwNB_OOFMDLclhKL3_97YR9GRuFrmghWe6m1VcBc2yEu-cxcprGYh4kw8GQtECC7cAzI8TGgwfFmHLi4CSs_0RBizTUOvwR9tQUQPDc1I30Y1aexQDq3CEDUwecFRJ50o6Fcvwzz_bMfQMzpk3v7gwqqk9j0r7wGAOLbHs6/w640-h630/cheese_mask1.png" width="640" /></span></a></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">After update, all ccds have the same masks.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">8. remove or add a mask<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">a. How to remove a mask<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;">From [fig:cheese_newcheese], we see the cluster in the centre is also masked. This is not what we want, we now have to remove it. The easiest way is to open&nbsp;<i>mos2S002-bkg_region-sky.fits</i>&nbsp;and&nbsp;<i>mos2S002-bkg_region-sky.fits</i>&nbsp;with fv, and then manually change the radii to 0.</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">If you don’t want to do it manually, let’s do it with other commands in&nbsp;<i>ftools</i>. First, we need to decide which mask we have to remove, we convert&nbsp;<i>mos2S002-bkg_region-sky.fits&nbsp;</i>to a ds9 readable file again and load it:</span><i><span lang="EN-US">&nbsp;</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">in<i>&nbsp;src/cheese_script.py:</i></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="font-family: inherit;">a.regionextract("mos2S002-bkg_region-sky.fits","mos2_sky_v2.reg")</span></i></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">then:<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;">ds9 mos2S002-rate.fits -scale limits 0 5e-5 -smooth -region load mos2_sky_v2.reg &amp;</span></i></p><p class="MsoNormal" style="line-height: normal;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjYpBHLteW37vVUiy2gTQJN-o_VPra5G6Ld8bP5YsxaDRH2d4hOUl0bKOTDWPAK_JUqiYzFjJvBnCmv5gP3qWO2InF5oboXvh9UVFHgrE6N2dwdx3nn7ASnFnBPuPKuwP-WUEhi3fqpjjiWbAjLWHWFuD2xPNlrMg2ne3QxY8BH9ilvG1bnytwp4iuc/s320/cheese_cluster.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-family: inherit;"><img border="0" data-original-height="220" data-original-width="320" height="220" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjYpBHLteW37vVUiy2gTQJN-o_VPra5G6Ld8bP5YsxaDRH2d4hOUl0bKOTDWPAK_JUqiYzFjJvBnCmv5gP3qWO2InF5oboXvh9UVFHgrE6N2dwdx3nn7ASnFnBPuPKuwP-WUEhi3fqpjjiWbAjLWHWFuD2xPNlrMg2ne3QxY8BH9ilvG1bnytwp4iuc/s1600/cheese_cluster.png" width="320" /></span></a></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;">Close-up view of the cluster. There are two masks which have to be removed.</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">You see in the cluster, there are two masks. We have to remove them. We need the row numbers of these two masks in the file&nbsp;<i>mos2S002-bkg_region-sky.fits</i>. You can just check them in&nbsp;<i>mos2_sky_v2.reg</i>. They are in 1 and 12. The row number is also the same for the detector coordinate and other ccds.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">From&nbsp;<i>mos2_sky_v2.reg</i>., here are row 1 and 12, the radii of which you have to set to 0.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><div style="text-align: left;"><span style="font-family: inherit;"><i><span lang="EN-US">ellipse(24456.088,24862.07,1612.0641,1606.5356,-34.360435)<br /></span></i><i><span lang="EN-US">ellipse(23949.498,25638.992,563.02734,561.096,-79.42784)</span></i>&nbsp;</span></div><div style="text-align: left;"><span style="font-family: inherit;"><br /></span></div><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Then we just update it with fpartab<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><div style="text-align: left;"><span style="font-family: inherit;"><i><span lang="EN-GB" style="color: red;">fpartab 0 mos2S002-bkg_region-sky.fits+1 R row=1 element=1<br /></span></i><i><span lang="EN-GB" style="color: red;">fpartab 0 mos2S002-bkg_region-sky.fits+1 R row=1 element=2<br /></span></i><i><span lang="EN-GB" style="color: red;">fpartab 0 mos2S002-bkg_region-sky.fits+1 R row=12 element=1<br /></span></i><i><span lang="EN-GB" style="color: red;">fpartab 0 mos2S002-bkg_region-sky.fits+1 R row=12 element=2</span></i></span></div><div style="text-align: left;"><i><span lang="EN-GB" style="color: red; font-family: inherit;"><br /></span></i></div><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-GB" style="font-family: inherit;">“0” is the new value you want.&nbsp;<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-GB" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;">Then make the cheese image again:</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-GB" style="color: red; font-family: inherit;">make_mask inimage=mos2S002-obj-im.fits inmask= mos2S002-mask-im.fits outmask= mos2S002-cheese.fits reglist=mos2S002-bkg_region-sky<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span style="font-family: inherit;"><span lang="EN-GB" style="color: red;">&nbsp;</span>(src/cheese_script.py: a.rowchange() or a.rowchange_py())</span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span style="font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><span lang="EN-GB">&nbsp;</span><span lang="EN-GB">Now you open the&nbsp;</span><i><span lang="EN-US">mos2S002-bkg_region-sky</span></i><span lang="EN-GB">&nbsp;again, you see R of row 1 and 12 are changed to 0.</span></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-GB" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-GB" style="color: red; font-family: inherit;">fdump mos2S002-bkg_region-sky.fits+1 STDOUT "X Y R" 1,12 pagewidth=256 prhead=no clobber=yes</span></i></p><div style="text-align: left;"><span style="font-family: inherit;"><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R<br /></span></i><i><span lang="EN-US">&nbsp;<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;2.4456088E+04&nbsp;&nbsp;&nbsp;2.4862070E+04&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12&nbsp;&nbsp;&nbsp;2.3949498E+04&nbsp;&nbsp;&nbsp;2.5638992E+04&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00</span></i></span></div><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: inherit;">And the new cheese images:<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p><span style="font-family: inherit;"><i><span face="Arial, sans-serif" style="color: red;">ds9 pnS003-</span></i><i><span face="Arial, sans-serif" lang="EN-US" style="color: red;">cheese</span></i><i><span face="Arial, sans-serif" style="color: red;">.fits mos1S001-</span></i><i><span face="Arial, sans-serif" lang="EN-US" style="color: red;">cheese</span></i><i><span face="Arial, sans-serif" style="color: red;">.fits mos2S002-</span></i><i><span face="Arial, sans-serif" lang="EN-US" style="color: red;">cheese</span></i><i><span face="Arial, sans-serif" style="color: red;">.fits -frame lock image -zoom to fit &amp;&nbsp;<o:p></o:p></span></i></span></p><span style="font-family: inherit;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEirO8sTjVJ3QzuvaxmKAjpAfdI00YtMK72tTN07MZC7rZxYEh1ta1c6i0eK-6GsCy3aNHB1U-tnE0fANdhPk5DFlhHrZukqeyDjeZILnzqiY5Kiqwj_V0bX3LMadqRcTS9vInRLXldsGKYo0XBdwk935FohMIuxO5y396Ed2jnCbz8OzMtJO8FSGCh5/s1112/cheese_final.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" data-original-height="1110" data-original-width="1112" height="638" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEirO8sTjVJ3QzuvaxmKAjpAfdI00YtMK72tTN07MZC7rZxYEh1ta1c6i0eK-6GsCy3aNHB1U-tnE0fANdhPk5DFlhHrZukqeyDjeZILnzqiY5Kiqwj_V0bX3LMadqRcTS9vInRLXldsGKYo0XBdwk935FohMIuxO5y396Ed2jnCbz8OzMtJO8FSGCh5/w640-h638/cheese_final.png" width="640" /></a><br /></span><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;">In the new cheese images, the cluster in the centre is no longer masked.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><span lang="EN-US">&nbsp;</span>And these would be used for analysis hereafter.</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-GB" style="font-family: inherit;">b. How to add a mask<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-GB" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">Now we have got two rows in</span><i><span lang="EN-US" style="color: red;">&nbsp;</span><span lang="EN-GB">mos2S002-bkg_region-sky.fits&nbsp;</span></i><span lang="EN-GB">which are empty.<i>&nbsp;</i>If you want to add a mask, just update these two rows with new values. In case you are not able to modify the values of any row, you really need to “add” a mask,&nbsp;</span><span lang="EN-US">it is a little bit tricky…I am not sure whether there is a direct way to add a row to&nbsp;</span><i><span lang="EN-GB">mos2S002-bkg_region-sky.fits,</span></i><span lang="EN-US">no matter you are using&nbsp;<i>ftools&nbsp;</i>or&nbsp;<i>python</i>. To the best I know, you combine</span><i><span lang="EN-US">&nbsp;</span><span lang="EN-GB">mos2S002-bkg_region-sky.fits</span></i><span lang="EN-US">&nbsp;with a new file being the extra mask.&nbsp;</span><span lang="EN-GB"><o:p></o:p></span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;">First, we create an empty file called&nbsp;<i>empty.fits</i>&nbsp;using&nbsp;<i>mos2S002-bkg_region-sky.fits</i>, but set all R = 0, or remove unnecessary rows. Then, we input the values of new masks. The original file,<i>mos2S002-bkg_region-sky.fits</i>, has 70<i></i>rows, and in this example I need to add two extra masks, so I delete row 1-68 in the following:</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><br /></span></p><div style="text-align: left;"><span style="font-family: inherit;"><span style="color: red;">cp&nbsp;</span><i style="color: red;">mos2S002-bkg_region-sky.fits empty.fits<br /></i><span lang="EN-US" style="color: red;">cp&nbsp;<i>mos2S002-bkg_region-det.fits emptydet.fits<br /></i></span><i><span lang="EN-US" style="color: red;">fdelrow empty.fits+1 1 68 N Y &nbsp;&nbsp;</span></i></span></div><div style="text-align: left;"><i><span lang="EN-US" style="color: red; font-family: inherit;"><br /></span></i></div><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: inherit;">Suppose I have to add the following masks (in sky coordinate):</span></p><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><div style="text-align: left;"><span style="font-family: inherit;"><i><span lang="EN-US">X=17515.893 Y=19017.939&nbsp;&nbsp;R1=500&nbsp;&nbsp;R2=500<br /></span></i><i><span lang="EN-US">X=28728.593. Y=19418.211&nbsp;&nbsp;R1=1006.1019&nbsp;&nbsp;&nbsp;R2=553.08489&nbsp;&nbsp;rotation angle=50</span></i></span></div><div style="text-align: left;"><i><span lang="EN-US" style="font-family: inherit;"><br /></span></i></div><p class="MsoNormal" style="line-height: normal; text-align: left;"><span style="font-family: inherit;">I update the above parameters in&nbsp;<i>empty.fits</i>.</span></p><p class="MsoNormal" style="line-height: normal; text-align: left;"><span style="font-family: inherit;"><br /></span></p><div style="text-align: left;"><span style="font-family: inherit;"><i><span lang="EN-US" style="color: red;">fpartab 17515.893 empty.fits+1 X row=1 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 19017.939 empty.fits+1 Y row=1 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 500 empty.fits+1 R row=1 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 500 empty.fits+1 R row=1 element=2<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 0 empty.fits+1 ROTANG row=1 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 28728.593 empty.fits+1 X row=2 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 19418.211 empty.fits+1 Y row=2 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 1006.1019 empty.fits+1 R row=2 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 553.08489 empty.fits+1 R row=2 element=2<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 50 empty.fits+1 ROTANG row=2 element=1</span></i>&nbsp;</span></div><div style="text-align: left;"><span style="font-family: inherit;"><br /></span></div><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: inherit;">Check if the update is successful.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;">fdump empty.fits+1 STDOUT "X Y R" row=1,2 prhead=no showcol=no</span></i></p><div style="text-align: left;"><span style="font-family: inherit;"><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;1.7515893E+04&nbsp;&nbsp;&nbsp;1.9017939E+04&nbsp;&nbsp;&nbsp;5.0000000E+02&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;5.0000000E+02&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;2.8728594E+04&nbsp;&nbsp;&nbsp;1.9418211E+04&nbsp;&nbsp;&nbsp;1.0061019E+03&nbsp;&nbsp;&nbsp;5.0000000E+01<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;5.5308490E+02&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00</span></i></span></div><div style="text-align: left;"><i><span lang="EN-US" style="font-family: inherit;"><br /></span></i></div><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: inherit;">Now merge&nbsp;<i>empty</i>.fits to&nbsp;<i>mos2S002-bkg_region-sky.fits</i></span></p><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: inherit;"><i><br /></i></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><i><span lang="EN-US" style="color: red;">fmerge "mos2S002-bkg_region-sky.fits[1] empty.fits[1]" mos2S002-bkg_region-sky.fits - clobber=yes</span></i><i><span lang="EN-US" style="color: red;"><o:p></o:p></span></i></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><span lang="EN-US">Now you check the last two rows of&nbsp;</span><i><span lang="EN-US">mos2S002-bkg_region-sky.fits&nbsp;</span></i><span lang="EN-US">and you see the new masks are added.</span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;">fdump mos2S002-bkg_region-sky.fits+1 STDOUT "X Y R ROTANG" row=71,72 prhead=no showcol=no<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;">The terminal shows the new masks:</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><br /></span></p><div style="text-align: left;"><span style="font-family: inherit;"><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;21&nbsp;&nbsp;&nbsp;1.7515893E+04&nbsp;&nbsp;&nbsp;1.9017939E+04&nbsp;&nbsp;&nbsp;5.0000000E+02&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;5.0000000E+02&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;22&nbsp;&nbsp;&nbsp;2.8728594E+04&nbsp;&nbsp;&nbsp;1.9418211E+04&nbsp;&nbsp;&nbsp;1.0061019E+03&nbsp;&nbsp;&nbsp;5.0000000E+01<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;5.5308490E+02&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00</span></i><br /></span></div><div style="text-align: left;"><i><span lang="EN-US" style="font-family: inherit;"><br /></span></i></div><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: inherit;">Not yet done! Remember to run the following to make&nbsp;<i>mos2S002-cheese-new.</i>fits</span></p><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;">make_mask inimage=mos2S002-obj-im.fits inmask=mos2S002-mask-im.fits outmask=mos2S002-cheese-new.fits reglist=mos2S002-bkg_region-sky.fits &nbsp;</span></i></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: inherit;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">(<i>src/cheese_script.py</i>: <i>a,emptyFits(),a.NewMask(),a.Mergefits and a.MakeMask()</i> )</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Now check the old and new cheese image in blink mode. You can easily see the new masks.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><i><span lang="EN-US" style="color: red;">ds9 mos2S002-cheese-new.fits mos2S002-cheese.fits&nbsp;</span></i><i><span lang="EN-US" style="color: red;">-lock frame image -blink &amp;</span></i>&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;">Still we have to update&nbsp;<i>mos2S002-bkg_region-det.fits</i>, but when you run&nbsp;<i>src/cheese_script.py</i>, this file is updated.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: inherit;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-GB" style="font-family: inherit;"><b>Reference Websites:</b><o:p></o:p></span></p><div style="text-align: left;">
					<span style="font-family: inherit;"><i><span lang="EN-GB">eboxdetect</span></i><i><span lang="EN-GB">:</span></i> <a href="http://xmm-tools.cosmos.esa.int/external/sas/current/doc/eboxdetect" class="current level_1" target=”_blank” ><span lang="EN-GB">&nbsp;http://xmm-tools.cosmos.esa.int/external/sas/current/doc/eboxdetect/<br /><o:p></o:p></span> </a> 

<span lang="EN-GB">esplinemap: </span></i><a href="http://xmm-tools.cosmos.esa.int/external/sas/current/doc/esplinemap" class="current level_1" target=”_blank” >
						  <span lang="EN-GB"> http://xmm-tools.cosmos.esa.int/external/sas/current/doc/esplinemap/<br /></span><i> </a> 


<span lang="EN-GB">emldetect:</span></i>
<a href="http://xmm-tools.cosmos.esa.int/external/sas/current/doc/emldect/" class="current level_1" target=”_blank” >
  <span lang="EN-GB">&nbsp;http://xmm-tools.cosmos.esa.int/external/sas/current/doc/emldetect/<br /></a> 


<o:p></o:p></span><i><span lang="EN-GB">ftools:</span></i><a name="OLE_LINK1"></a><a name="OLE_LINK2">

<a href="https://heasarc.gsfc.nasa.gov/lheasoft/ftools/futils.html" class="current level_1" target=”_blank” >

  <span lang="EN-GB" style="line-height: 18.4px;">&nbsp;</span><span lang="EN-US" style="line-height: 18.4px;">https://heasarc.gsfc.nasa.gov/lheasoft/ftools/futils.html</span></span></a>



<!--
===============================================================================================================================
-->

					    
</style></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-GB" style="font-size: 12pt; line-height: 18.4px;">&nbsp;</span></p>
      
                              

   

</body>
</html>

 

 

  

    
 

 
</head>


</html>
