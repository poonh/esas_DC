<!DOCTYPE html>
<head>
    <meta charset="utf-8"/>
    <link rel="dns-prefetch preconnect" href="https://u.jimcdn.com/" crossorigin="anonymous"/>
    <link rel="dns-prefetch preconnect" href="https://assets.jimstatic.com/" crossorigin="anonymous"/>
    <link rel="dns-prefetch preconnect" href="https://image.jimcdn.com" crossorigin="anonymous"/>
    <link rel="dns-prefetch preconnect" href="https://fonts.jimstatic.com" crossorigin="anonymous"/>
    <link rel="dns-prefetch preconnect" href="https://www.google-analytics.com" crossorigin="anonymous"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="description" content=""/>
    <meta name="robots" content="index, follow, archive"/>
    <meta property="st:section" content=""/>
 
    <title>ESAS Deconstruction</title>
 


    <style>
    html, body {
        margin:0
    }

    .hidden {
        display:none
    }

    .n {
        padding:5px
    }

    #emotion-header {
        position:relative
    }

    #emotion-header-logo, #emotion-header-title {
        position: absolute
    }
    </style>

    <link href="https://u.jimcdn.com/cms/o/s1c71c378b473a4b7/layout/l18102fdb581481be/css/main.css?t=1678435519" rel="stylesheet" type="text/css" id="jimdo_main_css"/>
    <link href="https://u.jimcdn.com/cms/o/s1c71c378b473a4b7/layout/l18102fdb581481be/css/layout.css?t=1481798901" rel="stylesheet" type="text/css" id="jimdo_layout_css"/>
    <link href="https://u.jimcdn.com/cms/o/s1c71c378b473a4b7/layout/l18102fdb581481be/css/font.css?t=1678435519" rel="stylesheet" type="text/css" id="jimdo_font_css"/>
    <script>

      
    /* <![CDATA[ */
    /*!  loadCss [c]2014 @scottjehl, Filament Group, Inc.  Licensed MIT */
    window.loadCSS = window.loadCss = function(e, n, t) {
        var r,
            l = window.document,
            a = l.createElement("link");
        if (n)
            r = n;
        else {
            var i = (l.body || l.getElementsByTagName("head")[0]).childNodes;
            r = i[i.length - 1]
        }
        var o = l.styleSheets;
        a.rel = "stylesheet",
        a.href = e,
        a.media = "only x",
        r.parentNode.insertBefore(a, n ? r : r.nextSibling);
        var d = function(e) {
            for (var n = a.href, t = o.length; t--;)
                if (o[t].href === n)
                    return e.call(a);
            setTimeout(function() {
                d(e)
            })
        };
        return a.onloadcssdefined = d, d(function() {
            a.media = t || "all"
        }), a
    };
    window.onloadCSS = function(n, o) {
        n.onload = function() {
            n.onload = null,
            o && o.call(n)
        },
        "isApplicationInstalled" in navigator && "onloadcssdefined" in n && n.onloadcssdefined(o)
    } /* ]]> */
    </script>
    <script>
    // <![CDATA[
    onloadCSS(loadCss('https://assets.jimstatic.com/web_oldtemplate.css.484168258c63bd4f69a74e0370dc7ab9.css'), function() {
        this.id = 'jimdo_web_css';
    });
    // ]]>
    </script>
    <link href="https://assets.jimstatic.com/web_oldtemplate.css.484168258c63bd4f69a74e0370dc7ab9.css" rel="preload" as="style"/>
    <noscript>
        <link href="https://assets.jimstatic.com/web_oldtemplate.css.484168258c63bd4f69a74e0370dc7ab9.css" rel="stylesheet"/>
    </noscript>
    <script>
    //<![CDATA[
    var jimdoData = {
        "isTestserver": false,
        "isLcJimdoCom": false,
        "isJimdoHelpCenter": false,
        "isProtectedPage": false,
        "cstok": "",
        "cacheJsKey": "dc04b44e71947b5963ce6fc1404a2bb2ea23e742",
        "cacheCssKey": "dc04b44e71947b5963ce6fc1404a2bb2ea23e742",
        "cdnUrl": "https:\/\/assets.jimstatic.com\/",
        "minUrl": "https:\/\/assets.jimstatic.com\/app\/cdn\/min\/file\/",
        "authUrl": "https:\/\/a.jimdo.com\/",
        "webPath": "https:\/\/www.npokokoro.jp\/",
        "appUrl": "https:\/\/a.jimdo.com\/",
        "cmsLanguage": "ja_JP",
        "isFreePackage": false,
        "mobile": false,
        "isDevkitTemplateUsed": false,
        "isTemplateResponsive": false,
        "websiteId": "s1c71c378b473a4b7",
        "pageId": 912164772,
        "packageId": 2,
        "shop": {
            "deliveryTimeTexts": {
                "1": "\u304a\u5c4a\u3051\u65e5\u6570\uff1a1~3\u65e5",
                "2": "\u304a\u5c4a\u3051\u65e5\u6570\uff1a3~5\u65e5",
                "3": "\u304a\u5c4a\u3051\u65e5\u6570\uff1a5~8\u65e5"
            },
            "checkoutButtonText": "\u8cfc\u5165",
            "isReady": false,
            "currencyFormat": {
                "pattern": "\u00a4#,##0",
                "convertedPattern": "$#,##0",
                "symbols": {
                    "GROUPING_SEPARATOR": ",",
                    "DECIMAL_SEPARATOR": ".",
                    "CURRENCY_SYMBOL": "\uffe5"
                }
            },
            "currencyLocale": "ja_JP"
        },
        "tr": {
            "gmap": {
                "searchNotFound": "\u5165\u529b\u3055\u308c\u305f\u4f4f\u6240\u306f\u5b58\u5728\u3057\u306a\u3044\u304b\u3001\u898b\u3064\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002",
                "routeNotFound": "\u30eb\u30fc\u30c8\u304c\u8a08\u7b97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u76ee\u7684\u5730\u304c\u9060\u3059\u304e\u308b\u304b\u660e\u78ba\u3067\u306f\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002"
            },
            "shop": {
                "checkoutSubmit": {
                    "next": "\u6b21\u3078",
                    "wait": "\u304a\u5f85\u3061\u304f\u3060\u3055\u3044"
                },
                "paypalError": "\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002",
                "cartBar": "\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8\u3092\u78ba\u8a8d",
                "maintenance": "\u7533\u3057\u8a33\u3054\u3056\u3044\u307e\u305b\u3093\u3001\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u4e2d\u306e\u305f\u3081\u4e00\u6642\u7684\u306b\u30b7\u30e7\u30c3\u30d7\u304c\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002\u3054\u8ff7\u60d1\u3092\u304a\u304b\u3051\u3057\u7533\u3057\u8a33\u3054\u3056\u3044\u307e\u305b\u3093\u304c\u3001\u304a\u6642\u9593\u3092\u3042\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002",
                "addToCartOverlay": {
                    "productInsertedText": "\u30ab\u30fc\u30c8\u306b\u5546\u54c1\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f",
                    "continueShoppingText": "\u8cb7\u3044\u7269\u3092\u7d9a\u3051\u308b",
                    "reloadPageText": "\u66f4\u65b0"
                },
                "notReadyText": "\u3053\u3061\u3089\u306e\u30b7\u30e7\u30c3\u30d7\u306f\u73fe\u5728\u6e96\u5099\u4e2d\u306e\u305f\u3081\u3054\u5229\u7528\u3044\u305f\u3060\u3051\u307e\u305b\u3093\u3002\u30b7\u30e7\u30c3\u30d7\u30aa\u30fc\u30ca\u30fc\u306f\u4ee5\u4e0b\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002https:\/\/help.jimdo.com\/hc\/ja\/articles\/115005521583",
                "numLeftText": "\u73fe\u5728\u3053\u306e\u5546\u54c1\u306f {:num} \u307e\u3067\u8cfc\u5165\u3067\u304d\u307e\u3059\u3002",
                "oneLeftText": "\u3053\u306e\u5546\u54c1\u306e\u5728\u5eab\u306f\u6b8b\u308a1\u70b9\u3067\u3059"
            },
            "common": {
                "timeout": "\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3044\u305f\u3057\u307e\u3057\u305f\u3002\u5f8c\u307b\u3069\u518d\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002"
            },
            "form": {
                "badRequest": "\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u5f8c\u307b\u3069\u6539\u3081\u3066\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"
            }
        },
        "jQuery": "jimdoGen002",
        "isJimdoMobileApp": false,
        "bgConfig": null,
        "bgFullscreen": null,
        "responsiveBreakpointLandscape": 767,
        "responsiveBreakpointPortrait": 480,
        "copyableHeadlineLinks": false,
        "tocGeneration": false,
        "googlemapsConsoleKey": false,
        "loggingForAnalytics": false,
        "loggingForPredefinedPages": false,
        "isFacebookPixelIdEnabled": false,
        "userAccountId": "0c3325d1-6b0b-446f-bc3b-e47d8fbb0d02",
        "dmp": {
            "typesquareFontApiKey": "4L6CCYWjET8%3D",
            "typesquareFontApiScriptUrl": "\/\/code.typesquare.com\/static\/4L6CCYWjET8%253D\/ts105.js",
            "typesquareFontsAvailable": true
        }
    };
    // ]]>
    </script>

    <script type="text/javascript">
    window.CKIES_OPTIN = true;
    </script>
    <script type="text/javascript">
    if (document.cookie.indexOf('ga-disable-UA-24230777-25') != -1 || !window.CookieControl.isCookieAllowed('ga') || !window.CookieControl.isCookieAllowed('jimdo_analytics')) {
        window['ga-disable-UA-24230777-25'] = true;
    }
    </script>
    <script>
    (function(window) {
        'use strict';
        var regBuff = window.__regModuleBuffer = [];
        var regModuleBuffer = function() {
            var args = [].slice.call(arguments);
            regBuff.push(args);
        };
        if (!window.regModule) {
            window.regModule = regModuleBuffer;
        }
    })(window);
    </script>
    <script src="https://assets.jimstatic.com/web.js.12719f3724127512fa9f.js" async="true"></script>

</head>
<body class="body cc-page cc-page-index cc-indexpage cc-pagemode-default cc-content-parent" id="page-912164772">

    <div id="cc-inner" class="cc-content-parent">
        <div id="cc-tp-padding-container" class="cc-content-parent">
            <div id="cc-tp-container" class="cc-content-parent">

                <div id="cc-tp-header">

                </div>

                <div id="cc-tp-wrapper">

                    <div id="cc-tp-navigation">
                        <div id="cc-tp-nav-top"></div>
                        <div class="cc-tp-gutter">
                            <div data-container="navigation">
                                <div class="j-nav-variant-standard">
                                    <ul id="mainNav1" class="mainNav1">
                                        <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/esas_DC/" class="current level_1">
                                                <span>HOME</span>
                                            </a>
                                        </li>
                                        <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/esas_DC/filter_SP.html" class="current level_1"> <!-- target="_blank"-->
                                                <span>Filtering for Soft Protons</span>
                                            </a>
                                        </li>
                                        <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/esas_DC/filter_SP.html" class="current level_1">
                                                <span>Anomalous CCD Check</span>
                                            </a>
                                        </li>
                                        <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/esas_DC/cheese.html" class="current level_1">
                                                <span>Masking Point Sources (Cheese)</span>
                                            </a>
                                        </li>
                                        <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/esas_DC/fovimage.html" class="current level_1">
                                                <span>FOV Image</span>
                                            </a>
                                        </li>
                                        <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/esas_DC/fovspectrum.html" class="current level_1">
                                                <span>FOV Spectrum</span>
                                            </a>
                                        </li>
					   <li id="cc-nav-view-912164772">
                                            <a href="https://poonh.github.io/about_me.html" class="current level_1">                                                <span>About Me</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div id="cc-tp-nav-btm"></div>
                    </div>
	
                    <div id="cc-tp-sidebar">
                        <div id="cc-tp-sidebar-top"></div>
                        <div class="cc-tp-gutter">
                            <div data-container="sidebar">
                                <div id="cc-matrix-1112072072">
                                    <div id="cc-m-11549662272" class="j-module n j-text ">
                                      <p style="text-align: center;">

                                      <p style="text-align: center;">
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="cc-tp-sidebar-btm"></div>
                    </div>

                </div>

                <div id="cc-tp-content" class="cc-content-parent">
                    <div id="cc-tp-content-top"></div>
                    <div class="cc-tp-gutter cc-content-parent">
                        <div id="content_area" data-container="content">
                            <div id="content_start"></div>

                            <div id="cc-matrix-1112072272">
                                <div id="cc-m-4981642472" class="j-module n j-header ">
                                    <h1 class="" id="cc-m-header-4981642472">Masking Point Sources(Cheese)</h1>
                                </div>
                                <div id="cc-m-4981638072" class="j-module n j-textWithImage ">
                                    <figure class="cc-imagewrapper cc-m-image-align-1">
                                       
                                     

                                    </figure>
                                    <div>
                                        <div id="cc-m-textwithimage-4981638072" data-name="text" data-action="text" class="cc-m-textwithimage-inline-rte">
                                            <!-- 
					    <p>
                                                <span style="color: #000000;">
                                                    <strong>Welcome to ESAS Deconstruction</strong>
                                                </span>
                                            </p>
                                             --> 


<!--
===============================================================================================================================
  --> <div style="text-align: right;"><span style="font-family: arial;"><span face="Arial, sans-serif" style="font-size: medium;">last updated: 2023/04/03</span></span></div><div style="text-align: left;"><span style="font-family: arial;"><span face="Arial, sans-serif" style="font-size: medium;"><br /></span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span><span face="Arial, sans-serif">Source: MCXC J0106.8+0103<br /></span></span><span><span face="Arial, sans-serif">Observation ID: 0762870601<br /></span></span><span>SAS Version: 19.0.0</span><span lang="EN-GB" style="line-height: 18.4px;"><br /></span></span></div><p style="text-align: left;"><span style="font-family: arial; font-size: medium;">The finished products and the&nbsp;scripts can be downloaded <a href="https://github.com/poonh/esas_DC/raw/main/cheese.zip">here.</a></span></p></a>&nbsp;You work in the main folder <i>cheese,</i> and put the ccf, SAS files and products from previous chapter like <i>mos1S001-clean.fits</i> in this folder.&nbsp;</span></p><p><b><span lang="EN-GB" style="font-family: arial; font-size: medium; line-height: 18.4px;"><br /></span></b></p><p><b><span lang="EN-GB" style="font-family: arial; font-size: medium; line-height: 18.4px;">Masking Point Sources</span></b></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-GB" style="font-family: arial; font-size: medium;">All files produced in this tutorial are found in&nbsp;<i>esas_products/cheese/</i>. Please note that some files have several updates. Those in the folder are files of the final update.</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><span lang="EN-GB">In ESAS,</span><span lang="EN-GB">&nbsp;</span><i><span lang="EN-US">cheese&nbsp;</span></i><span lang="EN-US">is used to mask point sources. Another common way to do is&nbsp;<i>ewavelet</i>.<o:p></o:p></span></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Here is the standard way to use cheese:</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;">cheese prefixm="1S001 2S002 " prefixp=S003 scale=0.25 rate=0.0001 dist=0 clobber=1 elow=400 ehigh=2300&nbsp;&nbsp;&gt; log/cheese.log<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">and you find the final products you need –&nbsp;<i>mos2S002-bkg_region-det.fits</i>,</span><span lang="EN-US">&nbsp;</span><i><span lang="EN-GB">mos2</span></i><i><span lang="EN-US">S002-bkg_region-sky.fits</span></i><span lang="EN-US">&nbsp;and&nbsp;<i>mos2S002-cheese.fits</i>. However, for SAS 19.0.0,&nbsp;<i>cheese&nbsp;</i>automatically deletes and renames some files upon completion. If you want to understand better what happens. I suggest running:</span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;">source command/cheese_full.csh<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US">cheese.csh</span></i><span lang="EN-US">&nbsp;has got all the sub-commands. In this tutorial, I use the products produced from this.&nbsp;</span><span lang="EN-US">I will first show the individual commands and then I will show you how to do the whole thing fast using the&nbsp;<i>python&nbsp;</i>script<i>src/cheese_script.py<o:p></o:p></i></span></span></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><span style="font-family: arial;"><span lang="EN-US" style="font-size: medium;"><i><br /></i></span></span></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;</span></span></p><p class="MsoNormal" style="line-height: normal; margin: 0cm; text-align: justify;"><span lang="EN-US"><span style="font-family: arial; font-size: medium;"><b>1.Step by step guide&nbsp;</b><span style="color: #00b050;"><o:p></o:p></span></span></span></p><p class="MsoNormal" style="line-height: normal; margin: 0cm; text-align: justify;"><span lang="EN-US"><span style="font-family: arial; font-size: medium;"><br /></span></span></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><span lang="EN-US"><span style="font-family: arial; font-size: medium;">Here are the basic steps in&nbsp;<i>cheese</i>.</span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Open the python script and see what you need.&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Here are the basic steps in&nbsp;<i>cheese</i>.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">1.Produce the following for point source detection:<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">a) an image extracted from mos2S002-clean.fits in a certain energy range of your choice<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">b) an exposure map in the same energy range<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">c) create a “mask” image from the exposure map on which the point sources search will perform. This is an image indicating the valid region for the search. CCDs and bad pixels are invalid regions with a value = 0, and all other parts =1.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><div style="text-align: left;"><span style="font-size: medium;"><span style="font-family: arial;"><span lang="EN-US">&nbsp;</span>2.&nbsp;</span><span style="font-family: arial;"><span lang="EN-US">run&nbsp;<i>eboxdetect</i>&nbsp;for the first time for local detection using the products produced in the previous step to&nbsp;</span><span lang="EN-US">produce a file called&nbsp;<i>eboxlist_l.fits.&nbsp;</i>This file contains detected point sources information.</span></span></span></div><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: 16.866667px; margin: 0cm;"><span lang="EN-US" style="font-size: medium;"><o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">3. Run&nbsp;<i>esplinemap</i>&nbsp;using&nbsp;<i>eboxlist_l.fits</i>&nbsp;to produce a background map called&nbsp;<i>mos2S002-obj-imbkg.fits</i>&nbsp;from non-source regions.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">4. Run&nbsp;<i>eboxdetect</i>&nbsp;for the second time for map detection using the background map produced from the previous step. A file called&nbsp;<i>eboxlist_m.fits</i>&nbsp;is produced, which has some overlap with&nbsp;</span><i><span lang="EN-US">eboxlist_l.fits.</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">5. Run<i>&nbsp;emldetect</i>&nbsp;to perform psf fitting on the point sources in&nbsp;<i>eboxlist_m.fits</i>. The final sources satisfying selection criteria is put in&nbsp;<i>emllist.fits</i>.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">6. Run&nbsp;<i>region</i>&nbsp;twice to create two fits files which contain the size and coordinates of the detected point sources satisfying selection criteria in sky and detector coordinates. The files are called&nbsp;<i>mos2S002-bkg_region-sky.fits</i>&nbsp;and&nbsp;<i>mos2S002-bkg_region-det.fits</i>.&nbsp;<i>mos2S002-bkg_region-det.fits</i>&nbsp;is used to mask point sources when producing a spectrum.&nbsp;<i>mos2S002-bkg_region-sky.fits</i>&nbsp;is used to create a mask in the image form which is used when handling image data in the next step. The point sources detected<i>&nbsp;</i>are different for different ccds. If you want the same mask for all ccds, update&nbsp;<i>mos2S002-bkg_region-sky.fits</i>&nbsp;and&nbsp;<i>mos2S002-bkg_region-det.fits</i>&nbsp;in this step.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">7. Run&nbsp;<i>make_mask</i>&nbsp;to translate the coordinates and sizes of the point sources in&nbsp;<i>mos2S002-bkg_region-sky.fits</i>&nbsp;to an image. The final product is&nbsp;<i>mos2S002-cheese</i>.<i>fits.&nbsp;</i>This file is used when handling image data.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;">8. Remove or add a mask. The source you feel interested in is probably masked. You have to remove it. Or if you want to enlarge the size of a certain mask or even add an extra mask, do it in this step.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Here comes the details:<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">1.Production of an image, exposure map and mask in a certain energy range.</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">For the energy range, choose the one you work on. My example is [0.3 – 2.4] keV, the range I use for image data. Of course, we use a far wider range for spectroscopic data, but using the narrow range would result in no difference, I believe.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Here are the steps for producing the image, exposure map and mask. All are in&nbsp;<i>src/cheese.csh.</i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Image<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;">evselect table=mos2S002-clean.fits:EVENTS withfilteredset=yes expression='(PATTERN&lt;=12)&amp;&amp;(FLAG == 0)&amp;&amp;(PI in [400:2300])' filtertype=expression imagebinning='imageSize' imagedatatype='Int32' imageset=mos2S002-obj-im.fits squarepixels=yes ignorelegallimits=yes withxranges=yes withyranges=yes xcolumn='X' ximagesize=900 ximagemax=48400 ximagemin=3401 ycolumn='Y' yimagesize=900 yimagemax=48400 yimagemin=3401 updateexposure=yes filterexposure=yes verbosity=1<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhFmLqE61V3bYm3xQjY5oBNjXSeesQrbV8fGne1of3sToDrCXz7HDe8TmFqFyw1--14illVO9LiP_2jdCUv_TrYbk61yk-eNneK6_RXSzUvjkHlhMwMBK20SeHf63grjTeESwpCTSYZTZ7J9uJiRx7JJUDx8u0DPysDe9arqTJuuaG5h1js2puLpZxn/s904/cheese_img.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" data-original-height="904" data-original-width="898" height="400" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhFmLqE61V3bYm3xQjY5oBNjXSeesQrbV8fGne1of3sToDrCXz7HDe8TmFqFyw1--14illVO9LiP_2jdCUv_TrYbk61yk-eNneK6_RXSzUvjkHlhMwMBK20SeHf63grjTeESwpCTSYZTZ7J9uJiRx7JJUDx8u0DPysDe9arqTJuuaG5h1js2puLpZxn/w398-h400/cheese_img.png" width="398" /></a><i><span lang="EN-US" style="color: red;">&nbsp;</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">an image extracted from&nbsp;<i>mos2S002-clean.fits</i>&nbsp;in [0.4 – 2.3] keV. This image shows the photons in this energy range.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">&nbsp;</span>exposure map</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;">eexpmap imageset=mos2S002-obj-im.fits attitudeset=atthk.fits eventset=mos2S002-clean.fits expimageset=mos2S002-obj-imexp.fits withdetcoords=no withvignetting=yes usefastpixelization=no usedlimap=no attrebin=4 pimin=400 pimax=2300&nbsp;<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">&nbsp;</span><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj4xsWF0ZS11WwKa3L_TBYM2Wu2bB8MgnPZMmEcyTKwyjz-VFnv-nHY-RqUN6gT1OCFS0k9u8hKxVN-C1P24MR_r14psE4wdvpKZY0yvdX32HX_DcqGpi2D3cODCpaVDdUPkdTolZTuAGSbi-lejyxjmZTVU1LRLFdVMzPQiOHE5_Y9q5lC_KJkKk8p/s896/cheese_exp.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" data-original-height="896" data-original-width="890" height="400" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj4xsWF0ZS11WwKa3L_TBYM2Wu2bB8MgnPZMmEcyTKwyjz-VFnv-nHY-RqUN6gT1OCFS0k9u8hKxVN-C1P24MR_r14psE4wdvpKZY0yvdX32HX_DcqGpi2D3cODCpaVDdUPkdTolZTuAGSbi-lejyxjmZTVU1LRLFdVMzPQiOHE5_Y9q5lC_KJkKk8p/w398-h400/cheese_exp.png" width="398" /></a></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">an exposure map in&nbsp;[0.4 – 2.3] keV. This has been corrected for vignetting effect. Otherwise, all pixels have the same value.&nbsp;</span>&nbsp;</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">mask<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;">emask expimageset=mos2S002-obj-imexp.fits detmaskset=mos2S002-obj-immask.fits detmasktable=MASK threshold1=0.3 threshold2=0.5<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEirLLA7f6OuY-jGFt6qvo78VyU6Keb5A6PmnqUmFeMBU0qL4I9lZPDxips0lPbTsP3lS72Gn6plD-WDuuh_rP8By9SCueVQoNenCutkopHH7O3-y1Mz9AviQ9UAf28_X0bFX_lJqod57flMmbm_a1QKfaTsra7SNQFlfYxzGYejZMzDSDC65H5lVwUi/s904/cheese_inmask.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-family: arial; font-size: medium;"><img border="0" data-original-height="904" data-original-width="892" height="400" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEirLLA7f6OuY-jGFt6qvo78VyU6Keb5A6PmnqUmFeMBU0qL4I9lZPDxips0lPbTsP3lS72Gn6plD-WDuuh_rP8By9SCueVQoNenCutkopHH7O3-y1Mz9AviQ9UAf28_X0bFX_lJqod57flMmbm_a1QKfaTsra7SNQFlfYxzGYejZMzDSDC65H5lVwUi/w395-h400/cheese_inmask.png" width="395" /></span></a></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">A mask indicating ccd gaps and bad pixels. All pixels have either a value of 0 or 1. Point source searches only perform on pixels with a value = 1.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">&nbsp;</span>2. run&nbsp;<i>eboxdetect</i>&nbsp;for the first time for local detection to produce a file called&nbsp;<i>eboxlist_l.fits.&nbsp;</i>This file contains detected point sources information.</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;">eboxdetect detmasksets='pnS003-obj-immask.fits mos1S001-obj-immask.fits mos2S002-obj-immask.fits' withdetmask=yes expimagesets='pnS003-obj-imexp.fits mos1S001-obj-imexp.fits mos2S002-obj-imexp.fits' withexpimage=yes nruns=3&nbsp;</span></i><b><span lang="EN-US">likemin=15</span></b><i><span lang="EN-US" style="color: red;">&nbsp;boxsize=5 ecf='3.2 1.2 1.2' imagesets='pnS003-obj-im.fits mos1S001-obj-im.fits mos2S002-obj-im.fits' boxlistset=eboxlist_l.fits hrdef='1 2 2 3 3 4' pimin='400 400 400' pimax='2300 2300 2300' obsmode=pointing</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">The critical parameter here is&nbsp;<i>likemin,&nbsp;</i>which determines the minimum detection likelihood. Now you can take a look at this file:</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;">fv eboxlist_l.fits &amp;<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;">It has 33 columns and 268 rows. For the column ID_INST,0=summary,1=pn,2=mos1,3=mos2. Check other parameters yourself.&nbsp;</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">3. Run&nbsp;<i>esplinemap</i>&nbsp;using&nbsp;<i>eboxlist_l.fits</i>&nbsp;to produce a background map called&nbsp;<i>mos2S002-obj-imbkg.fits</i>&nbsp;from non-source regions<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;">esplinemap&nbsp;</span></i><b><span lang="EN-US">scut=0.01 mlmin=1</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">nsplinenodes=20 excesssigma=4 nfitrun=3 idband=1 boxlistset=eboxlist_l.fits imageset=mos2S002-obj-im.fits expimageset=mos2S002-obj-imexp.fits withexpimage=yes detmaskset=mos2S002-obj-immask.fits withdetmask=yes bkgimageset=mos2S002-obj-imbkg.fits pimin=400 pimax=2300 fitmethod=spline snrmin=30 smoothsigma=15</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">The important parameters here are&nbsp;<i>scut</i>&nbsp;and&nbsp;<i>mlmin</i>.&nbsp;<i>scut&nbsp;</i>is the source cut level in counts/arcsec**2.&nbsp;<i>mlmin</i>&nbsp;is the minimum detection likelihood. The product of this command is&nbsp;<i>mos2S002-obj-imbkg.fits.&nbsp;</i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiiqSVcC0gGwmJ4eNKV2rZvN27pH43dRe8T09ttbMLYR5cuFkgWDJG_4uA_QO8-looxytOtkWmvvb-4DJ_XPr3nrAMZpvLHg67HzaZ-VpRHpKyO7XnKRY8ltUslpCn1ZmZYlRh7qbUF0x5DjV-iASfxWFgXybCozXkRulOProK8oksn6D-pKZQX71-j/s892/cheese_spline.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-family: arial; font-size: medium;"><img border="0" data-original-height="892" data-original-width="888" height="400" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiiqSVcC0gGwmJ4eNKV2rZvN27pH43dRe8T09ttbMLYR5cuFkgWDJG_4uA_QO8-looxytOtkWmvvb-4DJ_XPr3nrAMZpvLHg67HzaZ-VpRHpKyO7XnKRY8ltUslpCn1ZmZYlRh7qbUF0x5DjV-iASfxWFgXybCozXkRulOProK8oksn6D-pKZQX71-j/w399-h400/cheese_spline.png" width="399" /></span></a></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US">mos2S002-obj-imbkg.fits,&nbsp;</span></i><span lang="EN-US">A background map produced from&nbsp;<i>esplinemap</i>.<o:p></o:p></span></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;">&nbsp;<span lang="EN-US">4. Run&nbsp;<i>eboxdetect&nbsp;</i>for the second time for map detection using the background map produced from the previous step(</span><i><span lang="EN-US">mos2S002-obj-imbkg.fits</span></i><span lang="EN-US">). A file called&nbsp;<i>eboxlist_m.fits</i>&nbsp;is produced, which has more sources (336) than&nbsp;</span><i><span lang="EN-US">eboxlist_l.fits</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;">eboxdetect bkgimagesets='pnS003-obj-imbkg.fits mos1S001-obj-imbkg.fits mos2S002-obj-imbkg.fits' usemap=yes usematchedfilter=no detmasksets='pnS003-obj-immask.fits mos1S001-obj-immask.fits mos2S002-obj-immask.fits' withdetmask=yes expimagesets='pnS003-obj-imexp.fits mos1S001-obj-imexp.fits mos2S002-obj-imexp.fits' withexpimage=yes nruns=3&nbsp;</span></i><b><span lang="EN-US">likemin=15</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">boxsize=5 withimagebuffersize=no imagebuffersize=640 ecf='3.2 1.2 1.2' imagesets='pnS003-obj-im.fits mos1S001-obj-im.fits mos2S002-obj-im.fits' boxlistset=eboxlist_m.fits withoffsets=no mergedlistset=mergedlist.fits hrdef='1 2 2 3 3 4' pimin='400 400 400' pimax='2300 2300 2300' obsmode=pointing</span></i><i><span lang="EN-US" style="color: red;">&nbsp;</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Again the important parameter is&nbsp;<i>likemin.&nbsp;</i>Lowering this would result in more sources detected.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">5. Run<i>&nbsp;emldetect</i>&nbsp;to perform psf fitting on the sources in&nbsp;<i>eboxlist_m.fits</i>. The final sources satisfying selection criteria is put in&nbsp;<i>emllist.fits</i>.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;">emldetect boxlistset=eboxlist_m.fits mllistset=</span></i><b><span lang="EN-US">emllist.fits</span></b><i><span lang="EN-US">&nbsp;</span></i><b><span lang="EN-US">mlmin=10</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">determineerrors=yes fitposition=yes psfmodel=ellbeta nmaxfit=1 nmulsou=1&nbsp;</span></i><b><span lang="EN-US">ecut=15 scut=15</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">fitextent=yes extentmodel=beta dmlextmin=6 minextent=1.5 maxextent=20 withthreshold=yes threshold=15 threshcolumn=LIKE withtwostage=yes withimagebuffersize=no imagebuffersize=640 withxidband=no xidfixed=no rateonly=no simulate=no pimin='400 400 400' pimax='2300 2300 2300' hrpndef='1 2 2 3 3 4 4 5' xidpndef='2 3 4' hrm1def='1 2 2 3 3 4 4 5' xidm1def='2 3 4' hrm2def='1 2 2 3 3 4 4 5' xidm2def='2 3 4' ecf='3.2 1.2 1.2' xidecf=1 fitcounts=yes fitnegative=no mergedlistset=mergedlist.fits useevents=no usecalpsf=yes withhotpixelfilter=no withoffsets=no withrawrows=no tmpwrite=0 imagesets='pnS003-obj-im.fits mos1S001-obj-im.fits mos2S002-obj-im.fits' bkgimagesets='pnS003-obj-imbkg.fits mos1S001-obj-imbkg.fits mos2S002-obj-imbkg.fits' detmasksets='pnS003-obj-immask.fits mos1S001-obj-immask.fits mos2S002-obj-immask.fits' withdetmask=yes expimagesets='pnS003-obj-imexp.fits mos1S001-obj-imexp.fits mos2S002-obj-imexp.fits' withexpimage=yes&nbsp;</span></i><b><span lang="EN-US">sourceimagesets='pnS003-obj-imsmap.fits mos1S001-obj-imsmap.fits mos2S002-obj-imsmap.fits'</span></b><i><span lang="EN-US" style="color: red;">&nbsp;withsourcemap=yes</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">The most important parameter is again&nbsp;<i>mlmin</i>&nbsp;(minimum detection likelihood).&nbsp;<i>scut&nbsp;</i>(source selection radius for fitting) and&nbsp;<i>ecut</i>&nbsp;(source cut-out radius) may also have some effect in the result of source detection.&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Now all detected sources are in&nbsp;<i>emllist.fits</i>. Let’s open it:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;">fv emllist.fits &amp;</span></i></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">It has got 46 columns, including those in&nbsp;<i>eboxlist_m.fits</i>&nbsp;An important new column here is&nbsp;<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US">DET_ML</span></i><span lang="EN-US">, which is the detection likelihood. It will be used in the final extraction of the mask. When you add up this value of different ccds under the same&nbsp;<i>ID_CLUSTER</i>, it is roughly the summary column (i.e.&nbsp;<i>ID_INST</i>&nbsp;= 0).&nbsp;</span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">To make it easier to read, let’s output the important columns which will be used in the final mask extraction into a file called&nbsp;<i>emllist.txt</i>:<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">&nbsp;</span><i><span lang="EN-US" style="color: red;">fdump emllist.fits+1 emllist.txt "ID_INST ID_BAND ID_CLUSTER FLUX DET_ML DIST_NN" - pagewidth=256 prhead=no clobber=yes</span></i>&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">(<i>src/cheese_script.py:</i></span><span lang="EN-US">&nbsp;</span><i><span lang="EN-US">a.fitstotxt()&nbsp;</span></i><span lang="EN-US">for the above command<i>)<o:p></o:p></i></span></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><i><br /></i></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Now let’s open the source images which display all the sources detected in&nbsp;<i>emllist.fits</i>. These images are products of&nbsp;<i>emldetect.</i>They are the same for all ccds.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p><span style="font-family: arial; font-size: medium;"><i><span face="Arial, sans-serif" style="color: red;">ds9 pnS003-obj-imsmap.fits mos1S001-obj-imsmap.fits mos2S002-obj-imsmap.fits - frame lock image -zoom to fit -zscale -frame prev -zscale -frame prev -zscale &amp;&nbsp;</span></i><o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjDAqjB5jxvTbU7Qrv146JHZDYt_mKq3nI1xoYOtfojlVb1fIe236QsRToju55nVSb9fUjGBbnFZCZRMY5VEIyGusVFftZvH-jgRzvxbuweZJMr5kooav6F_qQIyNXf1xtOGHvTBgd1R06hXpMtstSUXPmLDcQoSVNiIwNWpcV6HvPNJ11LIW8JcSaJ/s1142/cheese_srcimage.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-family: arial; font-size: medium;"><img border="0" data-original-height="1142" data-original-width="1134" height="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjDAqjB5jxvTbU7Qrv146JHZDYt_mKq3nI1xoYOtfojlVb1fIe236QsRToju55nVSb9fUjGBbnFZCZRMY5VEIyGusVFftZvH-jgRzvxbuweZJMr5kooav6F_qQIyNXf1xtOGHvTBgd1R06hXpMtstSUXPmLDcQoSVNiIwNWpcV6HvPNJ11LIW8JcSaJ/w637-h640/cheese_srcimage.png" width="637" /></span></a></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-GB">pnS003-obj-imsmap.fits,mos1S001-obj-imsmap.fits&nbsp;</span></i><span lang="EN-GB">and<i>&nbsp;mos2S002-obj-imsmap.fits.&nbsp;</i></span><span lang="EN-US">The images display the sources detected in&nbsp;<i>emllist.fits.</i></span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><i><br /></i></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Now you can test by running&nbsp;<i>emldetect</i>&nbsp;again, but change&nbsp;<i>mlmin</i>&nbsp;to a larger value, e.g. 150, and open&nbsp;<i>mos2S002-obj-imsmap.</i>fits. You find there are a lot less sources.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">6&amp;7. Now we have finalized the sources in&nbsp;<i>emllist.fits</i>. We have to make further cuts to have the final list. Run&nbsp;<i>region</i>twice to create two fits files which contain the size and coordinates of the detected point sources satisfying selection criteria in sky and detector coordinates. The files are called&nbsp;<i>mos2S002-bkg_region-sky.fits&nbsp;</i>(for image data, this file needs further processing) and&nbsp;<i>mos2S002-bkg_region-det.fits&nbsp;</i>(for spectroscopic data).&nbsp;<i><o:p></o:p></i></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Remember at the beginning you input some parameters when calling&nbsp;<i>cheese</i>? Here are when these parameters come into play!</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;">region eventset=mos2S002-clean.fits operationstyle=global srclisttab=emllist.fits:SRCLIST expression='(</span></i><b><span lang="EN-US">FLUX &gt;= 1e-18</span></b><i><span lang="EN-US" style="color: red;">)&amp;&amp;(</span></i><b><span lang="EN-US">DET_ML &gt;= 15</span></b><i><span lang="EN-US" style="color: red;">)&amp;&amp;(</span></i><b><span lang="EN-US">ID_INST == 3</span></b><i><span lang="EN-US" style="color: red;">)&amp;&amp;(</span></i><b><span lang="EN-US">DIST_NN &gt;= 0</span></b><i><span lang="EN-US" style="color: red;">)&amp;&amp;(ID_BAND == 1)' bkgregionset=mos2S002-bkg_region-det.fits&nbsp;&nbsp;</span></i><b><span lang="EN-US">bkgfraction=0.25</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">radiusstyle=contour nosrcellipse=no&nbsp;</span></i><b><span lang="EN-US">outunit=detxy</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">verbosity=1</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;">region eventset=mos2S002-clean.fits operationstyle=global srclisttab=emllist.fits:SRCLIST expression='(DIST_NN &gt;= 0)&amp;&amp;(DET_ML &gt;= 15)&amp;&amp;(ID_INST == 3)&amp;&amp;(FLUX &gt;= 1e-18)&amp;&amp;(ID_BAND == 1)' bkgregionset=mos2S002-bkg_region-sky.fits radiusstyle=contour nosrcellipse=no bkgfraction=0.25&nbsp;</span></i><b><span lang="EN-US">outunit=xy</span></b><i><span lang="EN-US">&nbsp;</span></i><i><span lang="EN-US" style="color: red;">verbosity=1</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">When you run&nbsp;<i>cheese</i>, you input:&nbsp;<i>scale=0.25 rate=0.0001 dist=0</i>.&nbsp;<i>scale&nbsp;</i>is the&nbsp;<i>bkgfraction</i>, which means&nbsp;</span><span lang="EN-GB">the source is removed down to a level where the surface brightness of the source is one quarter of the surrounding background.&nbsp;</span><i><span lang="EN-US">rate=0.0001</span></i><span lang="EN-US">&nbsp;corresponds to&nbsp;<i>FLUX &gt;= 1e-18</i>.&nbsp;<i>rate=1</i>&nbsp;is 10**14 ergs /cm**2/s. and&nbsp;<i>dist=0</i>&nbsp;is&nbsp;<i>DIST_NN &gt;= 0</i>, which&nbsp;</span><span lang="EN-GB">is the minimum separation for sources in arc seconds (The cookbook suggests a default of 50, and can be as large as 1000).&nbsp;<i>outunit</i>&nbsp;is the source coordinate.&nbsp;<i>detxy&nbsp;</i>for detector and&nbsp;<i>xy</i>&nbsp;for sky coordinates.</span></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-GB" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">For&nbsp;<i>DET_ML &gt;= 15</i>, it is the detection likelihood limit.&nbsp;<i>ID_INST</i>&nbsp;indicates the instrument, with pn= 1, mos1=2, mos2=3. In this case, different ccds have their own mask since for the same source, they have a different&nbsp;<i>DET_ML</i>. Now let’s check how well the source mask masks sources. To begin with, let’s produce the rate image by dividing the counts image,&nbsp;<i>mos2S002-obj-im.fits</i>, by the exposure,&nbsp;<i>mos2S002-obj-imexp.fits</i>:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;">farith mos2S002-obj-im.fits mos2S002-obj-imexp.fits mos2S002-rate.fits DIV</span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">(<i>bin/cheese_script.py : a.makeImg()&nbsp;</i>for the above)</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Note that we don’t correct for oot events for pn here.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Next we have to convert&nbsp;<i>mos2S002-bkg_region-sky.fits&nbsp;</i>into ds9 readable format. The output is&nbsp;<i>mos2_sky.reg.&nbsp;</i>In<i>src/cheese_script.py</i>, you do it with this line:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="font-family: arial; font-size: medium;">a.regionextract("mos2S002-bkg_region-sky.fits",”mos2_sky.reg”)</span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">and the output is a text file with the coordinates and radii called&nbsp;<i>mos2_sky.reg</i>. If you convert other ccds and also the files for detector coordinates (<i>mos2S002-bkg_region-det.fits)</i>, you find for sky coordinates, different ccds have the same coordinates but not the detector ones. The radii are different for different ccds due to psf fitting.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Let’s take a look to learn better.&nbsp;</span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;">emacs mos1_sky.reg mos2_sky.reg pn_sky.reg<br /></span></i><i><span lang="EN-US" style="color: red;">emacs mos1_det.reg mos2_det.reg pn_det.reg &amp;</span></i></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;"><br /></span></i></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;"><br /></span></i></span></div><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Then we open&nbsp;<i>rate-mos2S002.fits</i>&nbsp;with the point sources of&nbsp;<i>mos2S002-bkg_region-sky.fits&nbsp;</i>loaded. You can also compare with&nbsp;<i>mos2S002-obj-imsmap.fits</i>, which shows the point sources not passing the selection criteria.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal; text-align: left;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">&nbsp;</span><i><span lang="EN-US" style="color: red;">ds9 mos2S002-rate.fits -scale limits 0 5e-5 -zoom to fit -smooth&nbsp;&nbsp;-region load mos2_sky.reg mos2S002-obj-imsmap.fits -zoom to fit -zscale &amp;</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg4TIsLchcOlCtq_MDqEashUF7sfhoEEmY7d5yfM2vwM-8NHMYAS0TBKr8rTfI-QlijZ1zN0wmzRluecGssHSKBWf6GnVYQ_6hDHbfeHLfKsF0BtRFdPtuboipdsBGVKhhYW1IaqOOKmRKZFziCOdsKldhn9tU8MeYlnB3EerwqjcJ8WFB1VL9oiVOZ/s1634/cheese_rate_imsmap.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-family: arial; font-size: medium;"><img border="0" data-original-height="820" data-original-width="1634" height="322" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg4TIsLchcOlCtq_MDqEashUF7sfhoEEmY7d5yfM2vwM-8NHMYAS0TBKr8rTfI-QlijZ1zN0wmzRluecGssHSKBWf6GnVYQ_6hDHbfeHLfKsF0BtRFdPtuboipdsBGVKhhYW1IaqOOKmRKZFziCOdsKldhn9tU8MeYlnB3EerwqjcJ8WFB1VL9oiVOZ/w640-h322/cheese_rate_imsmap.png" width="640" /></span></a></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">left:</span><i><span lang="EN-US" style="color: red;">&nbsp;</span></i><i><span lang="EN-US">rate-mos2S002.fits. right: mos2S002-obj-imsmap.fits,&nbsp;</span></i><span lang="EN-US">an image showing all sources in&nbsp;<i>emllist.fits.</i></span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><i><br /></i></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">&nbsp;</span>If you think it is not good, then do&nbsp;<i>region</i>&nbsp;again, lowering the threshold of&nbsp;<i>DET_ML</i>.&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">&nbsp;</span>Let’s check further all the ccds.</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">&nbsp;</span><i><span lang="EN-US" style="color: red;">ds9 rate-mos1S001.fits -scale limits 0 5e-5 -smooth -region load mos1_sky.reg rate-mos2S002.fits -scale limits 0 5e-5 -smooth -region load mos2_sky.reg rate-pnS003.fits -scale limits 0 5e-5 -zoom to fit -smooth -region load pn_sky.reg -frame prev -zoom to fit -frame prev -zoom to fit &amp;</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgvCHLT4L_cXCBDlzPQMzofXIwoL5zRU3WldSMxU_WQi-V4VNpdApd7pEERHeqzDa-Ctc3vtkxiCDY4nSPU1Lr9Di0PIVx-2ZfydI4O-qbOuTL3Ln6Kr-qOpAjd8hjYei6ilW4GsD42Uyl74FEATkyGMj2MjCEDSz5-QQ6viJIN6dp6UZft6v6IiaBo/s1370/cheese_all_v1.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-family: arial; font-size: medium;"><img border="0" data-original-height="1370" data-original-width="1324" height="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgvCHLT4L_cXCBDlzPQMzofXIwoL5zRU3WldSMxU_WQi-V4VNpdApd7pEERHeqzDa-Ctc3vtkxiCDY4nSPU1Lr9Di0PIVx-2ZfydI4O-qbOuTL3Ln6Kr-qOpAjd8hjYei6ilW4GsD42Uyl74FEATkyGMj2MjCEDSz5-QQ6viJIN6dp6UZft6v6IiaBo/w618-h640/cheese_all_v1.png" width="618" /></span></a></p><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">top left:&nbsp;</span><i><span lang="EN-US">rate-mos1S001.fits,</span></i><span lang="EN-US"><span>top right</span><i>: rate-mos2S002.fits</i><span>, bottom left</span><i>: rate-pnS003.fits</i></span></span></div><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><span lang="EN-US" style="font-size: medium;"><o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><i><br /></i></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Pn finds a lot more point sources! I believe the reason is pn detects photons a few times higher than mos1 and mos2, resulting in a higher detection likelihood. Now let’s load the rate images of mos2 but with the pn region file loaded, and compare with the one you just loaded:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;">ds9 rate-mos2S002.fits -scale limits 0 5e-5 -smooth -region load mos2_sky.reg rate-mos2S002.fits -scale limits 0 5e-5 -smooth -region load pn_sky.reg -zoom to fit -frame prev -zoom to fit&nbsp;&nbsp;&amp;<o:p></o:p></span></i></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">&nbsp;</span><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiEUFqSagXTekdwwBW13p4ajVk5OhhRCSjfYvkV5zrPm8q3SUpn2Iv-jPCsv0_MVdXr4RaTExbMAceFr63KuGgMFiA94D3EIs_0pwf3HB177DSuLnN-cA_Crxu9aY7OWyyMHydqyhMfqZ51PUVKwEEpFdNTOJf_AzNCROzXDF8MjDoX-_2kAOxSX1fU/s2140/cheese_large.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" data-original-height="1190" data-original-width="2140" height="356" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiEUFqSagXTekdwwBW13p4ajVk5OhhRCSjfYvkV5zrPm8q3SUpn2Iv-jPCsv0_MVdXr4RaTExbMAceFr63KuGgMFiA94D3EIs_0pwf3HB177DSuLnN-cA_Crxu9aY7OWyyMHydqyhMfqZ51PUVKwEEpFdNTOJf_AzNCROzXDF8MjDoX-_2kAOxSX1fU/w640-h356/cheese_large.png" width="640" /></a></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;">Close-up of <i>rate-mos2S002.fits</i>. The left one is loaded with mos2’s mask. The right one is loaded with pn’s mask. Green ellipses are common masks to both, cyan only found in mos2 and red only found in pn.&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">In the above figure, you see in some red ellipses, there is a faint source, but just too dim to pass the selection criteria. The opposite also happens. There are sources found in mos2 but not pn. If you want all ccds having the same mask, we have to do&nbsp;<i>region</i>&nbsp;again but choose the summary band, i.e.</span><i><span lang="EN-US" style="color: red;">&nbsp;</span></i><i><span lang="EN-US">(ID_INST ==0 )&amp;&amp;( ID_BAND == 0)</span></i><span lang="EN-US">. But if you open&nbsp;<i>emllist.fits</i>, you find for&nbsp;<i>ID_BAND=0</i>, there are a lot of&nbsp;<i>FLUX</i>&nbsp;with “INDEF”.&nbsp;</span></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Let’s take a look:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;">fdump emllist.fits+1 oldflux.txt "ID_INST FLUX" - pagewidth=256 prhead=no clobber=yes</span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;">If that mask is detected in one ccd (e.g. mos2 or pn), but falls on ccd gaps or missing ccds in another(e.g. mos1), the summary band would be “INDEF”. So, in order to use this band, we have to update&nbsp;<i>emllist.fits</i>&nbsp;first so that there is no INDEF value for the summary band. In&nbsp;<i>src/cheese_script.py</i>, you find the following line:</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><b><i><span lang="EN-US" style="font-family: arial; font-size: medium;">a.emllistUpdate()</span></i></b></p><p class="MsoNormal" style="line-height: normal;"><b><i><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></i></b></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;">The&nbsp;<i>FLUX&nbsp;</i>of the summary band is roughly the average of the ccds.&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Now check&nbsp;<i>emllist.fits</i>&nbsp;again:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;">fdump emllist.fits+1 newflux.txt "ID_INST FLUX" - pagewidth=256 prhead=no clobber=yes</span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Compare&nbsp;<i>newflux.txt</i>&nbsp;and&nbsp;<i>oldflux.txt</i>, and you see&nbsp;<i>FLUX</i>&nbsp;is successfully updated.&nbsp;</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><div style="text-align: left;"><span style="font-size: medium;"><span style="font-family: arial;"><span lang="EN-US">Now we do&nbsp;<i>region</i>&nbsp;again to extract&nbsp;</span><i><span lang="EN-US">mos2S002-bkg_region-det.fits&nbsp;</span></i><span lang="EN-US">and<i>&nbsp;mos2S002-bkg_region-sky.fits</i>, this time us</span></span><span lang="EN-US"><span style="font-family: arial;">ing the summary band,(<i>ID_INST == 0)&amp;&amp;(ID_BAND == 0):</i></span><o:p></o:p></span></span></div><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><i><br /></i></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial;"><i><span lang="EN-US" style="color: red; font-size: medium;">region eventset=mos2S002-clean.fits operationstyle=global srclisttab=emllist.fits:SRCLIST expression='(FLUX &gt;= 1e-18)&amp;&amp;(DET_ML &gt;= 15)&amp;&amp;(ID_INST == 0)&amp;&amp;(DIST_NN &gt;= 0)&amp;&amp;(ID_BAND == 0)' bkgregionset=mos2S002-bkg_region-det.fits&nbsp;&nbsp;bkgfraction=0.25 radiusstyle=contour nosrcellipse=no outunit=detxy verbosity=1</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;">region eventset=mos2S002-clean.fits operationstyle=global srclisttab=emllist.fits:SRCLIST expression='(DIST_NN &gt;= 0)&amp;&amp;(DET_ML &gt;= 15)&amp;&amp;(ID_INST == 0)&amp;&amp;(FLUX &gt;= 1e-18)&amp;&amp;(ID_BAND == 0)' bkgregionset=mos2S002-bkg_region-sky.fits radiusstyle=contour nosrcellipse=no bkgfraction=0.25 outunit=xy verbosity=1</span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">then make the cheese image again:</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;">make_mask inimage=mos2S002-obj-im.fits inmask=mos2S002-mask-im.fits outmask=mos2S002-cheese.fits reglist=mos2S002-bkg_region-sky.fits &nbsp;</span></i><i><span lang="EN-US" style="color: red;">&nbsp;</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US">(src/cheese_script.py:</span></i><i><span lang="EN-US">a.remakeRegion())</span></i></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><i><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">Now you open&nbsp;<i>mos1S001-cheese.fits, mos2S002-cheese.fits and pnS003-cheese.fits</i>, they all have the same masks. Sources detected in one ccd are also masked in other ccds.<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p><span style="font-family: arial; font-size: medium;"><i><span face="Arial, sans-serif" style="color: red;">ds9 pnS003-</span></i><i><span face="Arial, sans-serif" lang="EN-US" style="color: red;">cheese</span></i><i><span face="Arial, sans-serif" style="color: red;">.fits mos1S001-</span></i><i><span face="Arial, sans-serif" lang="EN-US" style="color: red;">che ese</span></i><i><span face="Arial, sans-serif" style="color: red;">.fits mos2S002-</span></i><i><span face="Arial, sans-serif" lang="EN-US" style="color: red;">cheese</span></i><i><span face="Arial, sans-serif" style="color: red;">.fits -frame lock image -zoom to fit &amp;&nbsp;</span></i><o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgLZ-NnOSZgQdoLUF9GnuwNB_OOFMDLclhKL3_97YR9GRuFrmghWe6m1VcBc2yEu-cxcprGYh4kw8GQtECC7cAzI8TGgwfFmHLi4CSs_0RBizTUOvwR9tQUQPDc1I30Y1aexQDq3CEDUwecFRJ50o6Fcvwzz_bMfQMzpk3v7gwqqk9j0r7wGAOLbHs6/s1276/cheese_mask1.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-family: arial; font-size: medium;"><img border="0" data-original-height="1256" data-original-width="1276" height="630" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgLZ-NnOSZgQdoLUF9GnuwNB_OOFMDLclhKL3_97YR9GRuFrmghWe6m1VcBc2yEu-cxcprGYh4kw8GQtECC7cAzI8TGgwfFmHLi4CSs_0RBizTUOvwR9tQUQPDc1I30Y1aexQDq3CEDUwecFRJ50o6Fcvwzz_bMfQMzpk3v7gwqqk9j0r7wGAOLbHs6/w640-h630/cheese_mask1.png" width="640" /></span></a></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">After update, all ccds have the same masks.</span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">8. remove or add a mask<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">a. How to remove a mask<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;">From the above, we see the cluster in the centre is also masked. This is not what we want, we now have to remove it. The easiest way is to open&nbsp;<i>mos2S002-bkg_region-sky.fits</i>&nbsp;and&nbsp;<i>mos2S002-bkg_region-sky.fits</i>&nbsp;with fv, and then manually change the radii to 0.</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">If you don’t want to do it manually, let’s do it with other commands in&nbsp;<i>ftools</i>. First, we need to decide which mask we have to remove, we convert&nbsp;<i>mos2S002-bkg_region-sky.fits&nbsp;</i>to a ds9 readable file again and load it:</span><i><span lang="EN-US">&nbsp;</span></i></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">in<i>&nbsp;src/cheese_script.py:</i></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="font-family: arial; font-size: medium;">a.regionextract("mos2S002-bkg_region-sky.fits","mos2_sky_v2.reg")</span></i></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="font-family: arial; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-family: arial; font-size: medium;">then:<o:p></o:p></span></p><p class="MsoNormal" style="line-height: normal;"><i><span lang="EN-US" style="color: red; font-family: arial; font-size: medium;">ds9 rate-mos2S002.fits -scale limits 0 5e-5 -smooth -region load mos2_sky_v2.reg &amp;</span></i></p><p class="MsoNormal" style="line-height: normal;"><span style="font-size: medium;"><i></i></span></p><div class="separator" style="clear: both; text-align: left;"><i><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh50bFBu6tuEiOE14MChNb_enzKhtFmy-H-gWVLxtuyCXpi5GVmdrzV8h0eYPLh70WNS1_W2s-1n9hk3zFG_wNwOwUt5DpfF9nVFESxr5T05grXKoyVmistnLSnxB2RPuJfnQOSTSIREqoFcYdInRIwfAU4gAoGcX32ew8znzZtMLJ1als_x6tsShVS/s1532/cheese_cluster.png" style="margin-left: 1em; margin-right: 1em;"><span style="font-size: medium;"><img border="0" data-original-height="854" data-original-width="1532" height="238" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh50bFBu6tuEiOE14MChNb_enzKhtFmy-H-gWVLxtuyCXpi5GVmdrzV8h0eYPLh70WNS1_W2s-1n9hk3zFG_wNwOwUt5DpfF9nVFESxr5T05grXKoyVmistnLSnxB2RPuJfnQOSTSIREqoFcYdInRIwfAU4gAoGcX32ew8znzZtMLJ1als_x6tsShVS/w427-h238/cheese_cluster.png" width="427" /></span></a></i></div><i><span style="font-size: medium;"><br /></span></i><p></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;">Close-up view of the cluster. There are two masks which have to be removed.</span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"><br /></span></p><p class="MsoNormal" style="line-height: normal;"><span style="font-family: arial; font-size: medium;"></span></p><div style="text-align: left;"><span style="font-size: medium;"><span style="font-family: arial;"><span lang="EN-GB">Just click on the ellipses and delete them, then save the new region file to&nbsp;<i>newregion.reg</i>. In the top panel of ds9, choose&nbsp;<i>Region</i>&nbsp;</span><span lang="EN-GB"></span></span><span lang="EN-GB"><span style="font-family: arial;">&nbsp;<i>Save Region</i>. Remember to save in&nbsp;<i>physical</i>&nbsp;coordiantes.</span><span style="color: #00b050;"><o:p></o:p></span></span></span></div><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><span lang="EN-GB" style="color: #00b050; font-size: medium;"><br /></span></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><span lang="EN-GB" style="color: #00b050; font-size: medium;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEix4VWo-fZIW4vUTdTYmeQJw6YZFh_bnbZWeKgWa1u6BV3muSDauED90z4_oinKMJad06j26Rt-1dOUxGaGv0_0Wf7atFFjiz815afMq7jSFm0FZF-WIm5TNo4uQENNQ5wAbRFnMWPzrxe3N9KnKpoyb3oJRgK618MyFxLxRrMdQq0M9ntDWLTYnW6O/s584/cheese_physical.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" data-original-height="244" data-original-width="584" height="134" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEix4VWo-fZIW4vUTdTYmeQJw6YZFh_bnbZWeKgWa1u6BV3muSDauED90z4_oinKMJad06j26Rt-1dOUxGaGv0_0Wf7atFFjiz815afMq7jSFm0FZF-WIm5TNo4uQENNQ5wAbRFnMWPzrxe3N9KnKpoyb3oJRgK618MyFxLxRrMdQq0M9ntDWLTYnW6O/s320/cheese_physical.png" width="320" /></a></span></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><span style="font-size: medium;"><br /></span></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><span lang="EN-GB" style="font-size: medium;"><br /></span></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><span lang="EN-GB" style="font-size: medium;"><br /></span></p><div style="text-align: left;"><span style="font-size: medium;"><span style="font-family: arial;"><span lang="EN-GB">If you have difficulty clicking on the ellipses, then on the top panel, choose&nbsp;<i>Edit&nbsp;--&gt;</i></span><i><span lang="EN-GB">&nbsp;Region</span></i></span><span lang="EN-GB"><span style="font-family: arial;">.</span><o:p></o:p></span></span></div><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><span lang="EN-GB" style="color: #00b050; font-size: medium;"><br /></span></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhaNtvoewEbe6hzX25ktraRUuizlznC9-932spWBuM2fN1STgxzt9xj6cPF1m7t0zWzApfvDcsllxx22Ig2P_fiPN1Y909uEytTxB4q9gaQQJl6PoGzIlXkOpvGRx2wAVgegbzLmBeNg9Z_V16B9wYURgON-xH-i5cKZrrp8NVHCjyDE3MrMOZ3EUCm/s1580/cheese_edit_region.png" style="clear: left; float: left; margin-bottom: 1em; margin-left: 1em;"><span style="font-size: medium;"><img border="0" data-original-height="1436" data-original-width="1580" height="291" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhaNtvoewEbe6hzX25ktraRUuizlznC9-932spWBuM2fN1STgxzt9xj6cPF1m7t0zWzApfvDcsllxx22Ig2P_fiPN1Y909uEytTxB4q9gaQQJl6PoGzIlXkOpvGRx2wAVgegbzLmBeNg9Z_V16B9wYURgON-xH-i5cKZrrp8NVHCjyDE3MrMOZ3EUCm/s320/cheese_edit_region.png" width="320" /></span></a></div><span style="font-size: medium;"><br /></span><div class="separator" style="clear: both; text-align: center;"><span style="font-size: medium;"><br /></span></div><span style="font-size: medium;"><br /><span lang="EN-GB" style="color: #00b050;"></span></span><p></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><span lang="EN-GB"><span style="font-family: arial; font-size: medium;">Also, when you click on the ellipse, the information is displayed: the number (its position in the file, you may need this number later), the coordinates, the size and the rotation angle.<o:p></o:p></span></span></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"></p><div class="separator" style="clear: both; text-align: left;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgzvpR8WtLAdMhGx38KZsd8JCsXQeENqenADUqb4gV33MvCfYynsIZpKrgFg7SNn46Yu4VpnIaezNfpfVTbfEahZYX544x1y-yVbYPAQ0Jl79eNClnfprkRWM1NpsX8L1UiBaoa0AACHJYOXtYxCKGhb0SEgQimVFOTVp5XzlqTkbO3avYkt1uvVdY2/s1322/cheese_circle_details.png" style="margin-left: 1em; margin-right: 1em;"><span style="font-size: medium;"><img border="0" data-original-height="1282" data-original-width="1322" height="375" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgzvpR8WtLAdMhGx38KZsd8JCsXQeENqenADUqb4gV33MvCfYynsIZpKrgFg7SNn46Yu4VpnIaezNfpfVTbfEahZYX544x1y-yVbYPAQ0Jl79eNClnfprkRWM1NpsX8L1UiBaoa0AACHJYOXtYxCKGhb0SEgQimVFOTVp5XzlqTkbO3avYkt1uvVdY2/w387-h375/cheese_circle_details.png" width="387" /></span></a></div><span style="font-size: medium;"><br /><span lang="EN-GB"><br /></span></span><p></p><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-GB">If you compare the old and new file,&nbsp;</span><i><span lang="EN-US">mos2_sky_v2.reg</span></i><span lang="EN-US">&nbsp;and&nbsp;<i>newregion.reg</i>, you should find 2 masks less. Now we update&nbsp;<i>mos2S002-bkg_region-sky.fits&nbsp;</i>and&nbsp;<i>mos2S002-bkg_region-sky.fits&nbsp;</i>with<i>&nbsp;newregion.reg.&nbsp;<o:p></o:p></i></span><span lang="EN-US"><i><br /></i></span><i><span lang="EN-US">&nbsp;<br /></span></i><span lang="EN-US">When you remove the ellipses previously, if you notice the number, it should be 1 and 12 that we are going to remove. Now let’s check the file before update:</span><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;<br /></span><i><span lang="EN-GB"><span style="color: red;">fdump mos2S002-bkg_region-sky.fits+1 STDOUT "X Y R" 1,12 pagewidth=256 prhead=no clobber=yes</span><br /></span></i><i><span lang="EN-GB">&nbsp;<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R<br /></span></i><i><span lang="EN-US">&nbsp;<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;2.4456088E+04&nbsp;&nbsp;&nbsp;2.4862070E+04&nbsp;&nbsp;&nbsp;1.6120641E+03<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;1.6065356E+03<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12&nbsp;&nbsp;&nbsp;2.3949498E+04&nbsp;&nbsp;&nbsp;2.5638992E+04&nbsp;&nbsp;&nbsp;5.6302734E+02<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;5.6109601E+02<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00</span></i></span></div><p class="MsoNormal" style="line-height: normal; margin: 0cm; text-align: left;"><span style="font-family: arial;"><span lang="EN-GB" style="font-size: medium;"></span></span></p><p class="MsoNormal" style="line-height: normal; margin: 0cm; text-align: left;"><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;</span></span></p><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /></span><span lang="EN-US">The same for&nbsp;<i>mos2S002-bkg_region-det.fits</i>. You see&nbsp;<i>X</i>,&nbsp;<i>Y</i>&nbsp;and&nbsp;<i>R&nbsp;</i>all have four elements, these are for different types of mask (i.e. circle, ellipse, polygon …etc). We are going to set&nbsp;<i>R&nbsp;</i>to 0. We will come back to this file again after update.<br /></span><i><span lang="EN-US">&nbsp;<br /></span></i><span lang="EN-US">In&nbsp;<i>src/cheese_script,&nbsp;</i>we first compare the two files and see which lines have to be removed:<br /></span><i><span lang="EN-US">&nbsp;<br /></span></i><i><span lang="EN-US">remove_index=a.DeleteMask("pn_sky_v2.reg","newregion.reg")<br /></span></i><span lang="EN-GB">&nbsp;<br /></span><span lang="EN-GB">then we remove the unwanted line:<br /></span><i><span lang="EN-GB">a.rowchange("mos2S002-bkg_region-sky.fits","R",0,remove_index,[1,2],ccd=mos2)<br /></span></i><span lang="EN-GB">&nbsp;<br /></span><span lang="EN-US">This line is equivalent to<br /></span><span lang="EN-US">&nbsp;<br /></span><i><span lang="EN-US" style="color: red;">fpartab 0 mos2S002-bkg_region-sky.fits+1 R row=1 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 0 mos2S002-bkg_region-sky.fits+1 R row=1 element=2<br /></span></i><i><span lang="EN-US" style="color: red;">&nbsp;<br /></span></i><span lang="EN-US">&nbsp;<br /></span><span lang="EN-US">With&nbsp;<i>fpartab</i>, you change a certain element of a certain row of a certain quantity to a certain value. Here we change the “R” of element 1and 2 or row 1 to 0. Here the “+1” of&nbsp;</span><i><span lang="EN-US">mos2S002-bkg_region-sky.fits+1</span></i><span lang="EN-US">&nbsp;means the first extension, which is&nbsp;<i>REGION.&nbsp;</i></span><span lang="EN-US">When you do&nbsp;<i>a.rowchange()</i>,&nbsp;</span><i><span lang="EN-GB">mos2S002-bkg_region-det.fits&nbsp;</span></i><span lang="EN-GB">is also updated with coordinate converted using&nbsp;<i>ecoordconv.&nbsp;</i>After the update, we make the cheese image again:</span><span lang="EN-GB"><br /></span><span lang="EN-GB">&nbsp;<br /></span><i><span lang="EN-GB" style="color: red;">make_mask inimage=mos2S002-obj-im.fits inmask= mos2S002-mask-im.fits outmask= mos2S002-cheese.fits reglist=mos2S002-bkg_region-sky.fits</span></i></span></div><p class="MsoNormal" style="line-height: 16.866667px; margin: 0cm; text-align: left;"><i><span lang="EN-GB" style="color: red;"><span style="font-family: arial; font-size: medium;"><br /></span></span></i></p><p class="MsoNormal" style="line-height: 16.866667px; margin: 0cm;"><i><span lang="EN-GB" style="color: red;"><span style="font-family: arial; font-size: medium;">&nbsp;</span></span></i></p><p class="MsoNormal" style="line-height: 16.866667px; margin: 0cm;"><span lang="EN-GB"><span style="font-family: arial; font-size: medium;">Now let’s check row 1 and 12 of&nbsp;<i>mos2S002-bkg_region-sky.</i>fits again, you see&nbsp;<i>R</i>&nbsp;is set to 0.<o:p></o:p></span></span></p><p class="MsoNormal" style="line-height: 16.866667px; margin: 0cm;"><span lang="EN-GB"><span style="font-family: arial; font-size: medium;"><br /></span></span></p><p class="MsoNormal" style="line-height: 16.866667px; margin: 0cm;"><i><span lang="EN-GB" style="color: red;"><span style="font-family: arial; font-size: medium;">&nbsp;</span></span></i></p><p class="MsoNormal" style="line-height: 16.866667px; margin: 0cm;"><i><span lang="EN-GB" style="color: red;"><span style="font-family: arial; font-size: medium;">fdump&nbsp;<a name="OLE_LINK5"></a><a name="OLE_LINK6">mos2S002-bkg_region-sky.fits</a>+1 STDOUT "X Y R" 1,12 pagewidth=256 prhead=no clobber=yes<o:p></o:p></span></span></i></p><p class="MsoNormal" style="line-height: 16.866667px; margin: 0cm;"><i><span lang="EN-GB" style="color: red;"><span style="font-family: arial; font-size: medium;">&nbsp;</span></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R<o:p></o:p></span></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;</span></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;2.4456088E+04&nbsp;&nbsp;&nbsp;2.4862070E+04&nbsp;&nbsp;&nbsp;0.0000000E+00<o:p></o:p></span></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<o:p></o:p></span></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<o:p></o:p></span></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<o:p></o:p></span></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12&nbsp;&nbsp;&nbsp;2.3949498E+04&nbsp;&nbsp;&nbsp;2.5638992E+04&nbsp;&nbsp;&nbsp;0.0000000E+00<o:p></o:p></span></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<o:p></o:p></span></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<o:p></o:p></span></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<o:p></o:p></span></span></i></p><p style="margin-left: 0cm; margin-right: 0cm;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US">Again the same for&nbsp;</span><i>mos2S002-bkg_region-</i><i><span lang="EN-US">det</span></i><i>.fits</i><span lang="EN-US">. If you are not familiar with&nbsp;</span><i>ecoordconv</i><span lang="EN-US">. I suggest that you try converting the sky coordinates to detector coordinate susing this, and cross check with&nbsp;</span><i>mos2S002-bkg_region-</i><i><span lang="EN-US">det</span></i><i>.fits</i><span lang="EN-US">.<o:p></o:p></span></span></p><p style="margin-left: 0cm; margin-right: 0cm;"><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;</span></span></p><div style="text-align: left;"><span style="font-size: medium;"><span lang="EN-US"><span style="font-family: arial;">Finally, here are the cheese images we want:<br /></span></span><span style="font-family: arial;"><i><span style="color: red;">ds9 pnS003-</span></i><i><span lang="EN-US" style="color: red;">cheese</span></i><i><span style="color: red;">.fits mos1S001-</span></i><i><span lang="EN-US" style="color: red;">cheese</span></i><i><span style="color: red;">.fits mos2S002-</span></i><i><span lang="EN-US" style="color: red;">cheese</span></i><i><span style="color: red;">.fits -frame lock image -zoom to fit &amp;&nbsp;<o:p></o:p></span></i></span></span></div><div style="text-align: left;"><span style="font-family: arial;"><i><span style="color: red; font-size: medium;"><br /></span></i></span></div><div style="text-align: left;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEirO8sTjVJ3QzuvaxmKAjpAfdI00YtMK72tTN07MZC7rZxYEh1ta1c6i0eK-6GsCy3aNHB1U-tnE0fANdhPk5DFlhHrZukqeyDjeZILnzqiY5Kiqwj_V0bX3LMadqRcTS9vInRLXldsGKYo0XBdwk935FohMIuxO5y396Ed2jnCbz8OzMtJO8FSGCh5/s1112/cheese_final.png" style="font-family: arial; margin-left: 1em; margin-right: 1em; text-align: center;"><span style="font-size: medium;"><img border="0" data-original-height="1110" data-original-width="1112" height="638" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEirO8sTjVJ3QzuvaxmKAjpAfdI00YtMK72tTN07MZC7rZxYEh1ta1c6i0eK-6GsCy3aNHB1U-tnE0fANdhPk5DFlhHrZukqeyDjeZILnzqiY5Kiqwj_V0bX3LMadqRcTS9vInRLXldsGKYo0XBdwk935FohMIuxO5y396Ed2jnCbz8OzMtJO8FSGCh5/w640-h638/cheese_final.png" width="640" /></span></a></div><p class="MsoNormal" style="line-height: normal; margin: 0cm; text-align: left;"><span style="font-family: arial;"><span lang="EN-US" style="font-size: medium;"></span></span></p><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-GB"><br /></span><span lang="EN-US">In the new cheese images, the cluster in the centre is no longer masked.</span><span lang="EN-GB"><br /></span><span lang="EN-US">And these would be used for analysis hereafter.</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;<br /></span><span lang="EN-GB">b. How to add a mask</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-GB"><br /></span><span lang="EN-US">Now we have got two rows in</span><i><span lang="EN-US" style="color: red;">&nbsp;</span><span lang="EN-GB">mos2S002-bkg_region-sky.fits&nbsp;</span></i><span lang="EN-GB">empty.<i>&nbsp;</i>If you want to add a mask, just update these two rows with new values using&nbsp;<i>fpartab</i>&nbsp;or&nbsp;<i>a.ChangeMask()</i>&nbsp;in&nbsp;<i>src/cheese_script.py</i>. For extended sources,&nbsp;<i>cheese&nbsp;</i>always cannot produce a mask large enough.</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-GB"><br /><o:p></o:p></span><span lang="EN-GB">&nbsp;<br /></span><span lang="EN-GB">In case you are not able to modify the values of any row, you really need to “add” a mask,&nbsp;</span><span lang="EN-US">it is a little bit tricky…I am not sure whether there is a direct way to add a row to&nbsp;</span><i><span lang="EN-GB">mos2S002-bkg_region-sky.fits,</span></i><span lang="EN-US">&nbsp;no matter you are using&nbsp;<i>ftools&nbsp;</i>or&nbsp;<i>python</i>. To the best I know, you combine</span><i><span lang="EN-US">&nbsp;</span><span lang="EN-GB">mos2S002-bkg_region-sky.fits</span></i><span lang="EN-US">&nbsp;with a new file being the extra mask.&nbsp;</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;<br /></span><span lang="EN-US">First, we create an empty file called&nbsp;<i>empty.fits</i>&nbsp;using&nbsp;<i>mos2S002-bkg_region-sky.fits</i>, but set all R = 0, or remove unnecessary rows. Then, we input the values of new masks. The original file,<i>mos2S002-bkg_region-sky.fits</i>, has 70<i></i>rows, and in this example I need to add two extra masks, so I delete row 1-68 in the following:</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;<br /></span><span lang="EN-US" style="color: red;">cp&nbsp;<i>mos2S002-bkg_region-sky.fits empty.fits<br /><o:p></o:p></i></span><span lang="EN-US" style="color: red;">cp&nbsp;<i>mos2S002-bkg_region-det.fits emptydet.fits<br /></i></span><i><span lang="EN-US" style="color: red;">fdelrow empty.fits+1 1 68 N Y&nbsp;&nbsp;&nbsp;</span></i></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;"><br /></span></i><span lang="EN-US">&nbsp;<br /></span><span lang="EN-US">Suppose I have to add the following masks (in sky coordinate):</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;<br /></span><i><span lang="EN-US">X=17515.893 Y=19017.939&nbsp;&nbsp;R1=500&nbsp;&nbsp;R2=500<br /></span></i><i><span lang="EN-US">X=28728.593. Y=19418.211&nbsp;&nbsp;R1=1006.1019&nbsp;&nbsp;&nbsp;R2=553.08489&nbsp;&nbsp;rotation angle=50</span></i></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US"><br /></span></i><i><span lang="EN-US">&nbsp;<br /></span></i><span lang="EN-US">I update the above parameters in&nbsp;<i>empty.fits</i>.</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;<br /></span><i><span lang="EN-US" style="color: red;">fpartab 17515.893 empty.fits+1 X row=1 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 19017.939 empty.fits+1 Y row=1 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 500 empty.fits+1 R row=1 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 500 empty.fits+1 R row=1 element=2<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 0 empty.fits+1 ROTANG row=1 element=1</span></i></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;"><br /></span></i><i><span lang="EN-US" style="color: red;">&nbsp;<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 28728.593 empty.fits+1 X row=2 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 19418.211 empty.fits+1 Y row=2 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 1006.1019 empty.fits+1 R row=2 element=1<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 553.08489 empty.fits+1 R row=2 element=2<br /></span></i><i><span lang="EN-US" style="color: red;">fpartab 50 empty.fits+1 ROTANG row=2 element=1</span></i></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;"><br /></span></i><span lang="EN-US">&nbsp;<br /></span><span lang="EN-US">&nbsp;<br /></span><span lang="EN-US">Check if the update is successful.</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /></span><i><span lang="EN-US" style="color: red;">fdump empty.fits+1 STDOUT "X Y R" row=1,2 prhead=no showcol=no</span></i></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;"><br /></span></i><i><span lang="EN-US" style="color: red;">&nbsp;<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;1.7515893E+04&nbsp;&nbsp;&nbsp;1.9017939E+04&nbsp;&nbsp;&nbsp;5.0000000E+02&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;5.0000000E+02&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;2.8728594E+04&nbsp;&nbsp;&nbsp;1.9418211E+04&nbsp;&nbsp;&nbsp;1.0061019E+03&nbsp;&nbsp;&nbsp;5.0000000E+01<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;5.5308490E+02&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00</span></i></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US"><br /></span></i><span lang="EN-US">&nbsp;<br /></span><span lang="EN-US">Now merge&nbsp;<i>empty</i>.fits to&nbsp;<i>mos2S002-bkg_region-sky.fits</i></span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><i><br /><o:p></o:p></i></span><span lang="EN-US">&nbsp;<br /></span><i><span lang="EN-US" style="color: red;">fmerge "mos2S002-bkg_region-sky.fits[1] empty.fits[1]" mos2S002-bkg_region-sky.fits - clobber=yes</span></i></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;"><br /></span></i><span lang="EN-US">&nbsp;<br /></span><span lang="EN-US">Now you check the last two rows of&nbsp;</span><i><span lang="EN-US">mos2S002-bkg_region-sky.fits&nbsp;</span></i><span lang="EN-US">and you see the new masks are added.</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /><o:p></o:p></span><span lang="EN-US">&nbsp;<br /></span><i><span lang="EN-US" style="color: red;">fdump mos2S002-bkg_region-sky.fits+1 STDOUT "X Y R ROTANG" row=71,72 prhead=no showcol=no</span></i></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;"><br /></span></i><span lang="EN-US">&nbsp;<br /></span><span lang="EN-US">The terminal shows the new masks:</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;<br /></span><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;21&nbsp;&nbsp;&nbsp;1.7515893E+04&nbsp;&nbsp;&nbsp;1.9017939E+04&nbsp;&nbsp;&nbsp;5.0000000E+02&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;5.0000000E+02&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;22&nbsp;&nbsp;&nbsp;2.8728594E+04&nbsp;&nbsp;&nbsp;1.9418211E+04&nbsp;&nbsp;&nbsp;1.0061019E+03&nbsp;&nbsp;&nbsp;5.0000000E+01<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;5.5308490E+02&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><i><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00&nbsp;&nbsp;&nbsp;0.0000000E+00<br /></span></i><b><i><span lang="EN-US">&nbsp;<br /></span></i></b><b><i><span lang="EN-US">&nbsp;<br /></span></i></b><span lang="EN-US">Not yet done! Remember to run the following to make&nbsp;<i>mos2S002-cheese-new.</i>fits</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;&nbsp;&nbsp;<br /></span><i><span lang="EN-US" style="color: red;">make_mask inimage=mos2S002-obj-im.fits inmask=mos2S002-mask-im.fits outmask=mos2S002-cheese-new.fits reglist=mos2S002-bkg_region-sky.fits&nbsp;&nbsp;</span></i></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;"><br /></span></i><i><span lang="EN-US" style="color: red;">&nbsp;<br /></span></i><span lang="EN-US">(<i>src/cheese_script.py</i>: a,emptyFits(),a.NewMask(),a.Mergefits and a.MakeMask() )</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;&nbsp;&nbsp;<br /></span><span lang="EN-US">Now check the old and new cheese image in blink mode. You can easily see the new masks.</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;<br /></span><i><span lang="EN-US" style="color: red;">ds9 mos2S002-cheese-new.fits mos2S002-cheese.fits&nbsp;</span></i><i><span lang="EN-US" style="color: red;">-lock frame image -blink &amp;</span></i></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US" style="color: red;"><br /></span></i><span lang="EN-US">&nbsp;<br /></span><span lang="EN-US">Still we have to update&nbsp;<i>mos2S002-bkg_region-det.fits</i>, but when you run&nbsp;<i>src/cheese_script.py</i>, this file is updated.</span></span></div><p class="MsoNormal" style="line-height: normal; margin: 0cm; text-align: left;"><span style="font-family: arial;"><span lang="EN-GB" style="font-size: medium;"></span></span></p><p class="MsoNormal" style="line-height: normal; margin: 0cm; text-align: left;"><span style="font-family: arial;"><span lang="EN-GB" style="font-size: medium;"></span></span></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm; text-align: left;"><i><span lang="EN-US" style="font-size: medium;">&nbsp;</span></i></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm; text-align: left;"><i><span lang="EN-US" style="font-size: medium;"><br /></span></i></p><div style="text-align: left;"><span style="font-family: arial;"><b><i><span lang="EN-US" style="font-size: medium;">Fast way to do it</span></i></b></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><b><i><span lang="EN-US"><br /></span></i></b><span lang="EN-US">In&nbsp;<i>src/cheese_script.py</i>, I divide the above process into 5 steps. Mos1 is taken as mos1S001, mos2 as mos2S002, pn as pnS003. If these are not correct, open the script and change the lines defining the ccd prefixes at the beginning.</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;<br /></span><span lang="EN-US">1.Step1 opens the rate image&nbsp;<i>rate-mos2S002.fits</i>&nbsp;loaded with the region file&nbsp;<i>mos2S002-bkg_region-sky.fits</i>, and compare with&nbsp;<i>mos2S002-obj-imsmap.fits</i>, an image with all the sources detected in&nbsp;<i>emllist.fits</i>. If you think&nbsp;<i>mos2S002-bkg_region-sky</i>.fits has all the sources you want, proceed to the next step. If not, run&nbsp;<i>emldetect</i>&nbsp;again with different parameter values.</span></span></div><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;<br /></span><i><span lang="EN-US" style="color: red;">python src/cheese_script.py 1</span></i></span></div><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><span lang="EN-US" style="font-size: medium;">&nbsp;</span></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><span lang="EN-US" style="font-size: medium;">&nbsp;</span></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><span lang="EN-US" style="font-size: medium;">&nbsp;</span></p><div class="separator" style="clear: both; text-align: left;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiZtCwJrwYTrvAVwrUKFnEIAr19RxxBpdnDF-YvRxjMWiPWne-IzXpmQlHTNS4TJF8o6nVpD6zBoc_JcJm9r9Ha7jVb0BHWwFgCjNk5M2Bwj3tOQHDD8TGWJg_60xC7egXcP2b56tXJb7fugu2gD1Ei8gofDBR3O1vNLtXfTM3GEkZenUH8JFcdmcI6/s894/cheese_step3.png" style="margin-left: 1em; margin-right: 1em;"><span style="font-size: medium;"><img border="0" data-original-height="894" data-original-width="888" height="347" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiZtCwJrwYTrvAVwrUKFnEIAr19RxxBpdnDF-YvRxjMWiPWne-IzXpmQlHTNS4TJF8o6nVpD6zBoc_JcJm9r9Ha7jVb0BHWwFgCjNk5M2Bwj3tOQHDD8TGWJg_60xC7egXcP2b56tXJb7fugu2gD1Ei8gofDBR3O1vNLtXfTM3GEkZenUH8JFcdmcI6/w345-h347/cheese_step3.png" width="345" /></span></a></div><p></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US">rate-mos2S002.fits</span></i><span lang="EN-US">&nbsp;and&nbsp;<i>mos2S002-obj-imsmap.fits.&nbsp;</i>mos1 and pn are shown together in comparison after running step 1. In this stage, different ccds have different masks. If you are satisfied with the result, go to step 2. If not, run&nbsp;<i>emldetect</i>&nbsp;again with different parameter values.<o:p></o:p></span></span></p><div class="separator" style="clear: both;"><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;</span></span></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><span lang="EN-US"><span style="font-family: arial; font-size: medium;"><br /></span></span></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><span lang="EN-US"><span style="font-family: arial; font-size: medium;">2. Step2 first updates&nbsp;<i>emllist.fits</i>&nbsp;and reproduce all&nbsp;<i>***bkg_region-det.fits</i>&nbsp;and&nbsp;<i>***bkg_region-sky.fits</i>&nbsp;for mos1,mos2 and pn so that all ccds have the same masks. Then, ds9 opens the rate image loaded with the new masks. Delete all the masks you don’t want and save the new region file as newregion.reg in physical coordinates. mos1, mos2 and pn are all shown but you can just use any ccd. Choose the one with not much ccd gaps covering the source you are interested in. You see now all ccds have the same mask.<o:p></o:p></span></span></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><span lang="EN-US"><span style="font-family: arial; font-size: medium;"><br /></span></span></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;</span></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US" style="color: red; font-size: medium;"><span style="font-family: arial;">python src/cheese_script.py 2</span><span face="Arial, sans-serif"><o:p></o:p></span></span></i></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><i><span lang="EN-US" style="font-size: medium;">&nbsp;</span></i></p></div><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><span lang="EN-US" style="font-size: medium;"><br /></span></p><div class="separator" style="clear: both; font-family: Arial, sans-serif; text-align: left;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEidDDmyBhVk3VvemrRI3J-T1IGJdPwMfhM_Anikfejuhfz2RCNVX73ecCJ4j1kzZg1o3OolesWx-MHrYG-AqUdwbpXEd3s6ye2T_QxdqgwYtUTu7-AUXtA5JFXbvMwp-IYIPvCpm_MO9jkiNHa6SqSfbojI37XcX455Gn-XdOT3rL76el2x5jbqdGVM/s900/cheese_step2.png" style="margin-left: 1em; margin-right: 1em;"><span style="font-size: medium;"><img border="0" data-original-height="900" data-original-width="896" height="320" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEidDDmyBhVk3VvemrRI3J-T1IGJdPwMfhM_Anikfejuhfz2RCNVX73ecCJ4j1kzZg1o3OolesWx-MHrYG-AqUdwbpXEd3s6ye2T_QxdqgwYtUTu7-AUXtA5JFXbvMwp-IYIPvCpm_MO9jkiNHa6SqSfbojI37XcX455Gn-XdOT3rL76el2x5jbqdGVM/s320/cheese_step2.png" width="319" /></span></a></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US">rate-mos2S002.fits&nbsp;</span></i><span lang="EN-US">loaded with updated<i>&nbsp;***bkg_region-sky.</i>fits converted to ds9 readable format called<i>mos2_sky_v2.reg.</i>&nbsp;The cluster in the centre is our interest. We have to remove the two masks covering it and save the new file as&nbsp;<i>newregion.reg</i>.</span></span></div><div class="separator" style="clear: both; text-align: left;"><span lang="EN-US"><span style="font-family: arial; font-size: medium;"><br /></span></span></div><p></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;</span></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><span lang="EN-US"><span style="font-family: arial; font-size: medium;">3. Step3 returns you the final products you want – updated&nbsp;<i>***bkg_region-det.fits</i>&nbsp;and&nbsp;<i>***bkg_region-sky.fits</i>&nbsp;for mos1,mos2 and pn. ds9 opens the cheese images and the rate images loaded with updated mask.<o:p></o:p></span></span></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;"><br /></span></span></i></p><p class="MsoNormal" style="line-height: normal; margin: 0cm;"><i><span lang="EN-US"><span style="font-family: arial; font-size: medium;">&nbsp;</span></span></i></p><div style="text-align: left;"><i><span lang="EN-US" style="color: red;"><span style="font-family: arial; font-size: medium;">python src/cheese_script.py 3</span></span></i></div><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><i><span lang="EN-US" style="color: red; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><span lang="EN-US" style="font-size: medium;"><br /></span></p><div class="separator" style="clear: both; text-align: left;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh31XcVAUBXOWPLeAymonxCSXnP6Uh2TCWSL-R_7A3p6s29BpEzadrzBmTdlhme09WlMhMPo3rfBt3tRN-b3gXA48qnLWM8vxpWKEO4ZFrDPFTwuVm33uN0AmH3lELTte6Or82mFLy0oBek9pZtA5bnmlWgpIkbVbRHIGVjeoLcpRZXdMS8WEJHvj2e/s1634/cheese_step1.png" style="margin-left: 1em; margin-right: 1em;"><span style="font-size: medium;"><img border="0" data-original-height="802" data-original-width="1634" height="290" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh31XcVAUBXOWPLeAymonxCSXnP6Uh2TCWSL-R_7A3p6s29BpEzadrzBmTdlhme09WlMhMPo3rfBt3tRN-b3gXA48qnLWM8vxpWKEO4ZFrDPFTwuVm33uN0AmH3lELTte6Or82mFLy0oBek9pZtA5bnmlWgpIkbVbRHIGVjeoLcpRZXdMS8WEJHvj2e/w591-h290/cheese_step1.png" width="591" /></span></a></div><span style="font-size: medium;"><br /></span><p></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><span lang="EN-GB" style="font-size: medium;"><br /></span></p><div style="text-align: left;"><span style="font-family: arial; font-size: medium;"><i><span lang="EN-US">rate-mos2S002.fits&nbsp;</span></i><span lang="EN-US">loaded with the updated mask..If you don’t want further changes. This is the final product.&nbsp;<br /><o:p></o:p></span><span lang="EN-US">&nbsp;</span><span lang="EN-US"><br /></span><span lang="EN-US">Step4: If you need to enlarge a mask and if there is an empty row in&nbsp;<i>***bkg_region-sky.</i>fits. Open&nbsp;<i>src/cheese_script.py,</i>go to step 4 and enter the values of the new mask you want.&nbsp;<i>***bkg_region-det.</i>fits is also updated in this step.</span><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;<br /></span><i><span lang="EN-US" style="color: red;">python src/cheese_script.py 4</span></i><i><span lang="EN-US" style="color: red;"><br /></span></i><i><span lang="EN-US" style="color: red;">&nbsp;<br /></span></i><span lang="EN-US">Step4: If you really need to “add” a mask but not modifying any row, do this step. Open&nbsp;<i>src/cheese_script.py</i>, go to step5 and enter the new mask information.&nbsp;</span><span lang="EN-US"><br /></span><span lang="EN-US">&nbsp;<br /></span><i><span lang="EN-US" style="color: red;">python src/cheese_script.py 5<br /></span></i><i><span lang="EN-US" style="color: red;">&nbsp;</span></i></span></div><p class="MsoNormal" style="line-height: normal; margin: 0cm; text-align: left;"><i><span lang="EN-US" style="color: red;"><span style="font-family: arial; font-size: medium;">&nbsp;</span></span></i></p><div style="text-align: left;"><span style="font-size: medium;"><i><span lang="EN-US">&nbsp;<span style="font-family: arial;"><br /></span></span></i><span style="font-family: arial;"><span lang="EN-GB"><b>Reference Websites:<br /></b></span><i><span lang="EN-GB">eboxdetect</span></i><i><span lang="EN-GB">:</span></i><span lang="EN-GB">&nbsp;<a href="http://xmm-tools.cosmos.esa.int/external/sas/current/doc/eboxdetect/">http://xmm-tools.cosmos.esa.int/external/sas/current/doc/eboxdetect/</a><br /><o:p></o:p></span><span lang="EN-GB">esplinemap: <a href="http://xmm-tools.cosmos.esa.int/external/sas/current/doc/esplinemap/">http://xmm-tools.cosmos.esa.int/external/sas/current/doc/esplinemap/</a><br /></span><i><span lang="EN-GB">emldetect:</span></i><span lang="EN-GB">&nbsp;<a href="http://xmm-tools.cosmos.esa.int/external/sas/current/doc/emldetect/">http://xmm-tools.cosmos.esa.int/external/sas/current/doc/emldetect/</a><br /><o:p></o:p></span><i><span lang="EN-GB">ftools:</span></i><a name="OLE_LINK1"></a><a name="OLE_LINK2"><span lang="EN-GB" style="line-height: 18.4px;">&nbsp;</span></a><span lang="EN-US" style="line-height: 18.4px;"><a href="https://heasarc.gsfc.nasa.gov/lheasoft/ftools/futils.html">https://heasarc.gsfc.nasa.gov/lheasoft/ftools/futils.html</a></span><span lang="EN-GB"><br /></span><span lang="EN-GB"><br /></span></span></span></div><p class="MsoNormal" style="line-height: normal; margin: 0cm; text-align: left;"><span style="font-family: arial;"><span lang="EN-GB" style="font-size: medium;"></span></span></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm; text-align: left;"><i style="font-family: arial;"><span lang="EN-GB" style="color: red; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><i style="font-family: arial;"><span lang="EN-GB" style="color: red; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="font-family: Arial, sans-serif; line-height: normal; margin: 0cm;"><i style="font-family: arial;"><span lang="EN-GB" style="color: red; font-size: medium;"><br /></span></i></p><p class="MsoNormal" style="font-family: Arial, sans-serif; font-size: 11pt; line-height: normal; margin: 0cm;"><br /></p><style class="WebKit-mso-list-quirks-style">


<!--
===============================================================================================================================
-->

					    
</style></span></p><p class="MsoNormal" style="line-height: 16.866667px;"><span lang="EN-GB" style="font-size: 12pt; line-height: 18.4px;">&nbsp;</span></p>
      
                              

   

</body>
</html>

 

 

  

    
 

 
</head>


</html>
